<!DOCTYPE html>
<html lang="ko" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <title>(Sprint) Full Stack 애플리케이션 구성 | Hoonology</title>
    <meta name="description" content="Terraform으로 AWS 서비스 구축하기 - EC2 RDS S3 구축 (1)">
    
        <meta name="keywords" content="terraform, 테라폼, IaC">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="(Sprint) Full Stack 애플리케이션 구성 | Hoonology">
    <meta name="twitter:description" content="Terraform으로 AWS 서비스 구축하기 - EC2 RDS S3 구축 (1)">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dvqcvocet/image/upload/v1683864943/dev-jeans_kadf7q.png">
    
    
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="http://localhost:4000/Terraform-AWS/">
    <meta property="og:title" content="(Sprint) Full Stack 애플리케이션 구성 | Hoonology">
    <meta property="og:image" content="https://res.cloudinary.com/dvqcvocet/image/upload/v1683864943/dev-jeans_kadf7q.png">
    <meta property="og:description" content="Terraform으로 AWS 서비스 구축하기 - EC2 RDS S3 구축 (1)">
    <meta property="og:site_name" content="Hoonology | Welcome to Hoony's Blog !">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="Hoonology">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="http://localhost:4000/Terraform-AWS/">
    <link rel="alternate" type="application/rss+xml" title="Hoonology | Welcome to Hoony's Blog !" href="http://localhost:4000/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>
</head>

    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                Hoonology <span class="version"></span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/about">About</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/docker">Docker</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/aws">AWS</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/cicd">CICD</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/msa">MSA</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/terraform">Terraform</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/mornitoring">Mornitoring</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/k8s">k8s</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/project">Project</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/review">review</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2023-05-15T09:00:00+09:00">
                            


May 15, 2023

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>16 min to read</span>
                </p>
                <h1 class="post-title">(Sprint) Full Stack 애플리케이션 구성</h1>
                <p class="post-subtitle">Terraform</p>

                
                    <img src="https://res.cloudinary.com/dvqcvocet/image/upload/v1683864943/dev-jeans_kadf7q.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <h1 id="요구사항">요구사항</h1>

<p>다음의 아키텍처를 terraform을 이용해 작성합니다.
<img src="https://s3.ap-northeast-2.amazonaws.com/urclass-images/W6iTHPZQ1M80m-R0dsqZS-1642861410514.png" alt="Alt text" /></p>

<h1 id="getting-started">Getting Started</h1>

<p>IaC 코드를 작성하려면 먼저 AWS Management Console을 이용해 먼저 최종 인프라 상태를 만들어놓고, 잘 작동하는지 확인한 다음, 이를 해당하는 리소스를 하나씩 코드로 옮기는 방법을 사용하는 방식을 사용해 보면 좋습니다.</p>

<p>다음 자습서를 순서대로 따라 합니다. 먼저 AWS Management Console을 통해 최종 결과물을 따라 해보고, 예상 상태가 무엇인지 먼저 파악해야 합니다.</p>

<p>모든 리소스를 만들 때에는 반드시 이름을 붙여놓도록 합시다.</p>

<h2 id="step-1-자습서-db-인스턴스에-사용할-amazon-vpc-생성">STEP 1: 자습서: DB 인스턴스에 사용할 Amazon VPC 생성</h2>

<p><a href="https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/CHAP_Tutorials.WebServerDB.CreateVPC.html">링크</a></p>

<p><img src="https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/images/con-VPC-sec-grp.png" alt="Alt text" /></p>
<h4 id="1-vpc-및-서브넷-생성">1. VPC 및 서브넷 생성</h4>

<ul>
  <li>프라이빗 서브넷과 퍼블릭 서브넷이 각각 두 개, 총 네 개가 있어야 합니다.</li>
</ul>

<h4 id="프라이빗-서브넷과-퍼블릭-서브넷을-포함하는-vpc-생성">프라이빗 서브넷과 퍼블릭 서브넷을 포함하는 VPC 생성</h4>

<p>다음은 퍼블릭 서브넷과 프라이빗 서브넷을 모두 포함하는 VPC를 생성하는 절차입니다.</p>

<ul>
  <li>VPC 및 서브넷을 생성하는 방법
    <ul>
      <li>Amazon VPC 콘솔을 엽니다</li>
      <li>AWS Management Console의 오른쪽 상단에서 VPC를 생성할 리전을 선택합니다. 이 예에서는 미국 서부(오레곤) 리전을 사용합니다.</li>
      <li>왼쪽 상단 모서리에서 VPC 대시보드를 선택합니다. VPC 생성을 시작하려면 VPC 생성을 선택합니다.</li>
      <li>VPC 설정의 생성할 리소스에서 VPC 등을 선택합니다.</li>
      <li>VPC 설정을 위해 다음 값을 설정합니다.
        <ul>
          <li>네임 태그 자동 생성 - tutorial</li>
          <li>IPv4 CIDR block: - 10.0.0.0/16
            <ul>
              <li>이 블록은 10.0.0.0에서 10.0.255.255까지의 IP 주소 범위를 제공한다.</li>
            </ul>
          </li>
          <li>IPv6 CIDR 블록 - No IPv6 CIDR Block(IPv6 CIDR 블록 없음)</li>
          <li>테넌시 - 기본값</li>
        </ul>
      </li>
      <li>서브넷
        <ul>
          <li>프라이빗 서브넷을 만들고 싶기 때문에 각 프라이빗 서브넷에 대해 /24 CIDR 블록을 사용하는 것이 일반적입니다.</li>
        </ul>
      </li>
    </ul>

    <p><img src="/assets/img/Terraform/subnet1.png" alt="subnet" /></p>
    <ul>
      <li>가용 영역(AZ)의 수 - 2</li>
      <li>Customize AZs(AZ 사용자 지정) - 기본값을 유지합니다.</li>
      <li>퍼블릭 서브넷 수 – 2</li>
      <li>프라이빗 서브넷 수 – 2</li>
      <li>
        <p>Customize subnets CIDR blocks(서브넷 CIDR 블록 사용자 지정) - 기본값을 유지합니다.
<img src="/assets/img/Terraform/subnet3.png" alt="subnet" />
<img src="/assets/img/Terraform/subnet4.png" alt="subnet" />
<img src="/assets/img/Terraform/subnet5.png" alt="subnet" />
<img src="/assets/img/Terraform/subnet6.png" alt="subnet" />
<img src="/assets/img/Terraform/subnet7.png" alt="subnet" /></p>
      </li>
      <li>NAT 게이트웨이($) – 없음
        <ul>
          <li>NAT 게이트웨이는 퍼블릭 서브넷이 아닌 프라이빗 서브넷의 리소스에 대한 인터넷 액세스를 제공하는 데 사용됩니다. 반면에 인터넷 게이트웨이는 퍼블릭 서브넷의 리소스가 인터넷에 직접 액세스할 수 있도록 합니다.</li>
        </ul>
      </li>
      <li>VPC 엔드포인트 – 없음</li>
      <li>DNS options(DNS 옵션) - 기본값을 유지합니다.</li>
    </ul>
  </li>
</ul>

<h4 id="12-위-과정이-잘-안된다면-테라폼으로-작성해본다">1-2. 위 과정이 잘 안된다면 테라폼으로 작성해본다.</h4>

<p><code class="language-plaintext highlighter-rouge">provider.tf</code> 파일 생성</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform <span class="o">{</span>
  required_version ~|<span class="o">=</span>| <span class="s2">"&gt;~|=| 0.14.8"</span> 

  required_providers <span class="o">{</span>
      aws ~|<span class="o">=</span>| <span class="o">{</span>
          <span class="nb">source</span> ~|<span class="o">=</span>| <span class="s2">"hashicorp/aws"</span>
          version ~|<span class="o">=</span>| <span class="s2">"~&gt; 3.0"</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

provider <span class="s2">"aws"</span> <span class="o">{</span>
  region     ~|<span class="o">=</span>| <span class="s2">"ap~|-|northeast~|-|2"</span>
  ~|#| access_key 와 secert_key 를 파일에 적어서 구현할 수는 있지만 권장하지 않습니다.
  ~|#| access_key ~|<span class="o">=</span>| <span class="s2">"my~|-|access~|-|key"</span>
  ~|#| secret_key ~|<span class="o">=</span>| <span class="s2">"my~|-|secret~|-|key"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>초기화</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform init ~|-|upgrade
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">plan</code>은 실제로 리소스를 작성하기 전 리소스가 어떻게 생성되는지를 확인하는 명령어입니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~|#| vpc.tf
resource <span class="s2">"aws_vpc"</span> <span class="s2">"my~|-|vpc~|-|0515"</span> <span class="o">{</span>
  cidr_block ~|<span class="o">=</span>| <span class="s2">"10.0.0.0/16"</span>

~|#| 네임태그
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|vpc~|-|0515"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform plan
</code></pre></div></div>
<p><img src="/assets/img/Terraform/terraformPlan.png" alt="plan" /></p>

<p>CloudFormation의 create-change-set , execute-change-set 조합과 같습니다.</p>

<p>단순하게 plan 명령어만 입력하면 되기 때문에 CloudFormation을 사용하는 것보다 훨씬 빠르고 편하게 결과를 예측할 수 있습니다.</p>

<p><img src="/assets/img/Terraform/terraformApply.png" alt="apply" /></p>

<p>이제 AWS 콘솔로 가서 VPC에서 네임태그와 함께 올라가있는지 확인해줍니다.
<img src="/assets/img/Terraform/vpcCheck.png" alt="vpcCheck" /></p>

<h4 id="13-서브넷-작성">1-3. 서브넷 작성</h4>

<p>EC2에 사용할 2개의 퍼블릭 서브넷과 RDS에 사용할 2개의 프라이빗 서브넷을 작성</p>

<p>(파일은 사용자가 나누고 싶은대로 나눕니다.)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_subnet"</span> <span class="s2">"PublicSubnet01"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|<span class="o">=</span>| <span class="s2">"10.0.1.0/24"</span>
  availability_zone ~|<span class="o">=</span>| <span class="s2">"ap~|-|northeast~|-|2a"</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"public~|-|subnet01"</span>
  <span class="o">}</span>
<span class="o">}</span>

resource <span class="s2">"aws_subnet"</span> <span class="s2">"PublicSubnet02"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|<span class="o">=</span>| <span class="s2">"10.0.2.0/24"</span>
  availability_zone ~|<span class="o">=</span>| <span class="s2">"ap~|-|northeast~|-|2c"</span> ~|#| b는 t2 micro 적용이 안된다.
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"public~|-|subnet02"</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_subnet"</span> <span class="s2">"PrivateSubnet01"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|<span class="o">=</span>| <span class="s2">"10.0.3.0/24"</span>
  availability_zone ~|<span class="o">=</span>| <span class="s2">"ap~|-|northeast~|-|2a"</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"private~|-|subnet01"</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_subnet"</span> <span class="s2">"PrivateSubnet02"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|<span class="o">=</span>| <span class="s2">"10.0.4.0/24"</span>
  availability_zone ~|<span class="o">=</span>| <span class="s2">"ap~|-|northeast~|-|2c"</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"private~|-|subnet02"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="14-인터넷게이트웨이-igw-작성-">1-4. 인터넷게이트웨이 (IGW) 작성</h4>

<p>인터넷 게이트웨이는 VPC에 연결하여 VPC가 인터넷과 통신할 수 있도록 해줍니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_internet_gateway"</span> <span class="s2">"my~|-|IGW~|-|0515"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|IGW~|-|0515"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="15-라우팅테이블-작성">1-5. 라우팅테이블 작성</h4>

<p>VPC를 생성하면 기본 라우팅 테이블이 함께 만들어집니다. 하지만 VPC를 보호하기 위해 기본 라우팅 테이블은 초기 설정을 그대로 두고 <strong>사용하지 않는 것을 권장</strong>합니다.</p>

<p>라우팅 테이블을 작성하고 이를 서브넷과 연결해줍니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_route_table"</span> <span class="s2">"my~|-|public~|-|route01"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  route <span class="o">{</span>
    cidr_block ~|<span class="o">=</span>| <span class="s2">"0.0.0.0/0"</span>
    gateway_id ~|<span class="o">=</span>| aws_internet_gateway.my~|-|IGW~|-|0515.id
  <span class="o">}</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|public~|-|route01"</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_route_table"</span> <span class="s2">"my~|-|public~|-|route02"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  route <span class="o">{</span>
    cidr_block ~|<span class="o">=</span>| <span class="s2">"0.0.0.0/0"</span>
    gateway_id ~|<span class="o">=</span>| aws_internet_gateway.my~|-|IGW~|-|0515.id
  <span class="o">}</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|public~|-|route02"</span>
  <span class="o">}</span>
<span class="o">}</span>

~|#|~|#| 2. 프라이빗 라우팅 테이블 정의
resource <span class="s2">"aws_route_table"</span> <span class="s2">"my~|-|private~|-|route01"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id

  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|private~|-|route01"</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_route_table"</span> <span class="s2">"my~|-|private~|-|route02"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id

  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"my~|-|private~|-|route02"</span>
  <span class="o">}</span>
<span class="o">}</span>

~|#|~|#| 퍼블릭 라우팅 테이블 연결
resource <span class="s2">"aws_route_table_association"</span> <span class="s2">"my~|-|public~|-|RT~|-|Assoication01"</span> <span class="o">{</span>
  subnet_id ~|<span class="o">=</span>| aws_subnet.PublicSubnet01.id
  route_table_id ~|<span class="o">=</span>| aws_route_table.my~|-|public~|-|route01.id
<span class="o">}</span>
resource <span class="s2">"aws_route_table_association"</span> <span class="s2">"my~|-|public~|-|RT~|-|Assoication02"</span> <span class="o">{</span>
  subnet_id ~|<span class="o">=</span>| aws_subnet.PublicSubnet02.id
  route_table_id ~|<span class="o">=</span>| aws_route_table.my~|-|public~|-|route02.id
<span class="o">}</span>

~|#|~|#| 프라이빗 라우팅 테이블 연결
resource <span class="s2">"aws_route_table_association"</span> <span class="s2">"my~|-|private~|-|RT~|-|Assoication01"</span> <span class="o">{</span>
  subnet_id ~|<span class="o">=</span>| aws_subnet.PrivateSubnet01.id
  route_table_id ~|<span class="o">=</span>| aws_route_table.my~|-|private~|-|route01.id
<span class="o">}</span>
resource <span class="s2">"aws_route_table_association"</span> <span class="s2">"my~|-|private~|-|RT~|-|Assoication02"</span> <span class="o">{</span>
  subnet_id ~|<span class="o">=</span>| aws_subnet.PrivateSubnet02.id
  route_table_id ~|<span class="o">=</span>| aws_route_table.my~|-|private~|-|route02.id
<span class="o">}</span>
</code></pre></div></div>

<h4 id="2-vpc-보안-그룹-생성">2. VPC 보안 그룹 생성</h4>

<ul>
  <li>퍼블릭 웹 서버가 사용할 VPC 보안 그룹을 만들어야 합니다.</li>
  <li>프라이빗 DB 웹 서버가 사용할 VPC 보안 그룹을 만들어야 합니다.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~|#|~|#| 퍼블릭 보안 그룹
resource <span class="s2">"aws_security_group"</span> <span class="s2">"my~|-|public~|-|SG"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  name ~|<span class="o">=</span>| <span class="s2">"my public SG"</span>
  description ~|<span class="o">=</span>| <span class="s2">"my public SG"</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"log public SG"</span>
  <span class="o">}</span>
<span class="o">}</span>

~|#|~|#| 프라이빗 보안 그룹
resource <span class="s2">"aws_security_group"</span> <span class="s2">"my~|-|private~|-|SG"</span> <span class="o">{</span>
  vpc_id ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
  name ~|<span class="o">=</span>| <span class="s2">"my private SG"</span>
  description ~|<span class="o">=</span>| <span class="s2">"private SG"</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"log private SG"</span>
  <span class="o">}</span>
<span class="o">}</span>

~|#|~|#| 퍼블릭 보안 그룹 규칙
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|HTTPingress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"ingress"</span>
  from_port ~|<span class="o">=</span>| 80
  to_port ~|<span class="o">=</span>| 80
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span> <span class="o">]</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|HTTPegress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"egress"</span>
  from_port ~|<span class="o">=</span>| 80
  to_port ~|<span class="o">=</span>| 80
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span> <span class="o">]</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|HTTPSingress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"ingress"</span>
  from_port ~|<span class="o">=</span>| 443
  to_port ~|<span class="o">=</span>| 443
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span> <span class="o">]</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|HTTPSegress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"egress"</span>
  from_port ~|<span class="o">=</span>| 443
  to_port ~|<span class="o">=</span>| 443
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span> <span class="o">]</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|SSHingress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"ingress"</span>
  from_port ~|<span class="o">=</span>| 22
  to_port ~|<span class="o">=</span>| 22
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|/32"</span> <span class="o">]</span> ~|#| your IP
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|public~|-|SG~|-|Rules~|-|SSHegress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"egress"</span>
  from_port ~|<span class="o">=</span>| 22
  to_port ~|<span class="o">=</span>| 22
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  cidr_blocks ~|<span class="o">=</span>| <span class="o">[</span> <span class="s2">"~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|/32"</span> <span class="o">]</span> ~|#| your IP
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>

~|#|~|#|~|#| 프라이빗 보안 그룹 규칙 <span class="o">(</span> RDS <span class="o">)</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|private~|-|SG~|-|Rules~|-|RDSingress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"ingress"</span>
  from_port ~|<span class="o">=</span>| 3306
  to_port ~|<span class="o">=</span>| 3306
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|private~|-|SG.id
  source_security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>
resource <span class="s2">"aws_security_group_rule"</span> <span class="s2">"my~|-|private~|-|SG~|-|Rules~|-|RDSegress"</span> <span class="o">{</span>
  <span class="nb">type</span> ~|<span class="o">=</span>| <span class="s2">"egress"</span>
  from_port ~|<span class="o">=</span>| 3306
  to_port ~|<span class="o">=</span>| 3306
  protocol ~|<span class="o">=</span>| <span class="s2">"TCP"</span>
  security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|private~|-|SG.id
  source_security_group_id ~|<span class="o">=</span>| aws_security_group.my~|-|public~|-|SG.id
  lifecycle <span class="o">{</span>
    create_before_destroy ~|<span class="o">=</span>| <span class="nb">true</span>
  <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><img src="/assets/img/Terraform/awsconsole1.png" alt="aws" />
<img src="/assets/img/Terraform/awsconsole2.png" alt="aws" />
<img src="/assets/img/Terraform/awsconsole3.png" alt="aws" /></p>

<h4 id="3-db-서브넷-그룹-생성">3. DB 서브넷 그룹 생성</h4>

<ul>
  <li>RDS 인스턴스가 사용할 VPC 서브넷 그룹을 만들어야 합니다.</li>
</ul>

<h2 id="step-2-ec2-인스턴스-생성">STEP 2: EC2 인스턴스 생성</h2>

<p>만들어야 하는 사양은 다음과 같습니다.</p>
<ul>
  <li>키 페어: 수동으로 만들고 EC2에 할당합니다.</li>
  <li>AMI: Ubuntu Server 18</li>
  <li>인스턴스 타입: t2.micro</li>
  <li>사용자 데이터
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~|#|!/bin/bash
<span class="nb">echo</span> <span class="s2">"Hello, World"</span> <span class="o">&gt;</span> index.html
<span class="nb">nohup </span>busybox httpd ~|-|f ~|-|p <span class="k">${</span><span class="nv">var</span><span class="p">.server_port</span><span class="k">}</span> &amp;
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="1-키페어-생성-">1. 키페어 생성</h4>

<ul>
  <li>키 페어 할당
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh~|-|keygen ~|-|t rsa ~|-|b 4069 ~|-|C <span class="o">{</span>자신의 메일<span class="o">}</span> ~|-|f <span class="s2">"./testPubkey"</span> ~|-|N <span class="s2">""</span>
</code></pre></div>    </div>
    <p>디렉토리에 <code class="language-plaintext highlighter-rouge">testPubkey</code> 라고 명명한 키 페어 파일이 생성된다.</p>
  </li>
</ul>

<h4 id="2-ec2-생성">2. EC2 생성</h4>

<p><code class="language-plaintext highlighter-rouge">ec2.tf</code> 작성</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  resource <span class="s2">"aws_key_pair"</span> <span class="s2">"ec2_key"</span> <span class="o">{</span>
    key_name ~|<span class="o">=</span>| <span class="s2">"terraTest"</span>
    public_key ~|<span class="o">=</span>| file<span class="o">(</span><span class="s2">"./testPubkey.pub"</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>
<p>퍼블릭키 지정 2가지 방법</p>
<ul>
  <li>file로 지정</li>
  <li>공개키 ssh-rsa 값</li>
</ul>

<h4 id="3-인스턴스-생성">3. 인스턴스 생성</h4>

<p><a href="https://cloud-images.ubuntu.com/locator/ec2/">https://cloud-images.ubuntu.com/locator/ec2/</a><br />
내 리전에 맞는 EC2 ami id를 찾아서 값을 대입한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_instance"</span> <span class="s2">"test_ec2"</span> <span class="o">{</span>
  ami ~|<span class="o">=</span>| <span class="s2">"ami~|-|0da3b51b79ece2d3d"</span>
  instance_type ~|<span class="o">=</span>| <span class="s2">"t2.micro"</span>
  vpc_security_group_ids ~|<span class="o">=</span>| <span class="o">[</span> 
    aws_security_group.my~|-|public~|-|SG.id,
   <span class="o">]</span>
  subnet_id ~|<span class="o">=</span>| aws_subnet.PublicSubnet01.id
  key_name ~|<span class="o">=</span>| aws_key_pair.ec2_key.key_name
  root_block_device <span class="o">{</span>
    volume_size ~|<span class="o">=</span>| 200
    volume_type ~|<span class="o">=</span>| <span class="s2">"gp3"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위와 같이 작성 후 plan을 실행해본다.</p>

<p><img src="/assets/img/Terraform/plan.png" alt="plan" /></p>

<p>사용자 데이터를 넣어서 ec2.tf 파일을 완성시킨다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>variable <span class="s2">"server_port"</span> <span class="o">{</span>
  description ~|<span class="o">=</span>| <span class="s2">"The port number for the HTTP server"</span>
  <span class="nb">type</span>        ~|<span class="o">=</span>| number
  default     ~|<span class="o">=</span>| 8080
<span class="o">}</span>

resource <span class="s2">"aws_key_pair"</span> <span class="s2">"ec2_key"</span> <span class="o">{</span>
  key_name   ~|<span class="o">=</span>| <span class="s2">"terraTest"</span>
  public_key ~|<span class="o">=</span>| file<span class="o">(</span><span class="s2">"./testPubkey.pub"</span><span class="o">)</span>
<span class="o">}</span>

resource <span class="s2">"aws_instance"</span> <span class="s2">"test_ec2"</span> <span class="o">{</span>
  ami                    ~|<span class="o">=</span>| <span class="s2">"ami~|-|0da3b51b79ece2d3d"</span>
  instance_type          ~|<span class="o">=</span>| <span class="s2">"t2.micro"</span>
  vpc_security_group_ids ~|<span class="o">=</span>| <span class="o">[</span>aws_security_group.my~|-|public~|-|SG.id]
  subnet_id              ~|<span class="o">=</span>| aws_subnet.PublicSubnet01.id
  key_name               ~|<span class="o">=</span>| aws_key_pair.ec2_key.key_name

  root_block_device <span class="o">{</span>
    volume_size ~|<span class="o">=</span>| 200
    volume_type ~|<span class="o">=</span>| <span class="s2">"gp3"</span>
  <span class="o">}</span>

  user_data ~|<span class="o">=</span>| ~|&lt;|~|&lt;|~|-|EOF
    ~|#|!/bin/bash
    <span class="nb">echo</span> <span class="s2">"Hello, World"</span> <span class="o">&gt;</span> index.html
    <span class="nb">nohup </span>busybox httpd ~|-|f ~|-|p <span class="k">${</span><span class="nv">var</span><span class="p">.server_port</span><span class="k">}</span> &amp;
  EOF
<span class="o">}</span>
</code></pre></div></div>

<p>이제 <code class="language-plaintext highlighter-rouge">terraform apply</code>를 실행해본다.</p>

<h3 id="오류발생">오류발생</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>│ Error: Error launching <span class="nb">source </span>instance: InvalidParameterValue: The architecture 
|<span class="s1">'i386,x86_64'</span> of the specified instance <span class="nb">type </span>does not match the architecture <span class="s1">'arm64'</span> of 
|the specified AMI. Specify an instance <span class="nb">type </span>and an AMI that have matching architectures,
| and try again. You can use <span class="s1">'describe~|-|instance~|-|types'</span> or <span class="s1">'describe~|-|images'</span> to discover
| the architecture of the instance <span class="nb">type </span>or AMI.
│       status code: 400, request <span class="nb">id</span>: 48898fa9~|-|1f54~|-|4ab4~|-|b7b8~|-|81b3063cfb7e
│ 
│   with aws_instance.test_ec2,
│   on ec2.tf line 12, <span class="k">in </span>resource <span class="s2">"aws_instance"</span> <span class="s2">"test_ec2"</span>:
│   12: resource <span class="s2">"aws_instance"</span> <span class="s2">"test_ec2"</span> <span class="o">{</span>
</code></pre></div></div>
<h3 id="오류-해결">오류 해결</h3>

<ul>
  <li>오류 내용 : 오류 메시지는 지정된 인스턴스 유형의 아키텍처와 사용하려는 AMI의 아키텍처 간에 불일치가 있음을 나타냅니다. 인스턴스 유형은 ‘i386’ 또는 ‘x86_64’의 아키텍처를 예상하지만 제공한 AMI의 아키텍처는 ‘arm64’입니다.</li>
</ul>

<blockquote>
  <p>https://cloud-images.ubuntu.com/locator/ec2/ 사이트에서 내가 찾은 ami id가 arm64 기반으로 구성된 ubuntu18.04LTS라서 발생한 문제 같다.</p>
</blockquote>

<p>Ami ID를 “ami-0cb1d752d27600adb”로 바꿔줬더니 Apply가 성공했다.
<img src="/assets/img/Terraform/deploy.png" alt="deploy" /></p>

<h1 id="reference">Reference</h1>

<p>https://dev.classmethod.jp/articles/build-multiple-services-with-terraform-04/</p>

<h2 id="step-3-rds-생성">STEP 3: RDS 생성</h2>

<p>RDS에 서브넷을 지정하기 위해선 1개의 서브넷만 필요하더라도 서브넷 그룹으로 지정해야합니다.<br />
서브넷 그룹을 작성한 후 aws_db_instance리소스를 이용하여 RDS를 생성합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
  allocated_storage     ~|<span class="o">=</span>| 20
  engine                ~|<span class="o">=</span>| <span class="s2">"mysql"</span>
  engine_version        ~|<span class="o">=</span>| <span class="s2">"8.0.23"</span>
  instance_class        ~|<span class="o">=</span>| <span class="s2">"db.t3.micro"</span>
  name                  ~|<span class="o">=</span>| <span class="s2">"my~|-|db~|-|instance"</span>
  username              ~|<span class="o">=</span>| <span class="s2">"Iam_user"</span>
  password              ~|<span class="o">=</span>| <span class="s2">"12345678"</span>

~|#| Storage <span class="o">(</span> 스토리지 섹션 기본 값으로 설정 <span class="o">)</span>
  ~|#| No changes, keeping the default values

  ~|#| Connections
  ~|#| No changes, keeping the default values

  ~|#| Compute resource
  ~|#| No changes, as the connection is established using depends_on

  depends_on ~|<span class="o">=</span>| <span class="o">[</span>aws_instance.my~|-|ec2]
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">depends_on = [aws_instance.my-ec2]</code>를 추가하면 RDS 인스턴스 생성이 EC2 인스턴스 생성에 따라 달라져 EC2 인스턴스가 RDS 인스턴스보다 먼저 생성되도록 합니다.</p>

<h3 id="오류-발생">오류 발생</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> with aws_db_instance.my~|-|rds,
   on rds.tf line 1, <span class="k">in </span>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span>:
    1: resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
 
</code></pre></div></div>
<h3 id="오류-해결-1">오류 해결</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
  allocated_storage     ~|<span class="o">=</span>| 20
  engine                ~|<span class="o">=</span>| <span class="s2">"mysql"</span>
  engine_version        ~|<span class="o">=</span>| <span class="s2">"8.0.32"</span>
  instance_class        ~|<span class="o">=</span>| <span class="s2">"db.t3.micro"</span>
  username              ~|<span class="o">=</span>| <span class="s2">"Iam_user"</span>
  password              ~|<span class="o">=</span>| <span class="s2">"12345678"</span>

~|#| Storage <span class="o">(</span> 스토리지 섹션 기본 값으로 설정 <span class="o">)</span>
  ~|#| No changes, keeping the default values

  ~|#| Connections
  ~|#| No changes, keeping the default values

  ~|#| Compute resource
  ~|#| No changes, as the connection is established using depends_on

  depends_on ~|<span class="o">=</span>| <span class="o">[</span>aws_instance.my~|-|ec2]
    ~|#| Specify the subnet IDs <span class="k">for </span>the RDS instance
  db_subnet_group_name ~|<span class="o">=</span>| aws_db_subnet_group.default.name
<span class="o">}</span>

resource <span class="s2">"aws_db_subnet_group"</span> <span class="s2">"default"</span> <span class="o">{</span>
  name        ~|<span class="o">=</span>| <span class="s2">"default~|-|subnet~|-|group"</span>
  description ~|<span class="o">=</span>| <span class="s2">"Default subnet group for RDS"</span>
  subnet_ids  ~|<span class="o">=</span>| <span class="o">[</span>
    aws_subnet.PrivateSubnet01.id,
    aws_subnet.PrivateSubnet02.id,
  <span class="o">]</span>
  tags ~|<span class="o">=</span>| <span class="o">{</span>
    Name ~|<span class="o">=</span>| <span class="s2">"DefaultSubnetGroup"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>어떻게 해결했는가</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
  allocated_storage     ~|<span class="o">=</span>| 20
  engine                ~|<span class="o">=</span>| <span class="s2">"mysql"</span>
  engine_version        ~|<span class="o">=</span>| <span class="s2">"8.0.23"</span>
  instance_class        ~|<span class="o">=</span>| <span class="s2">"db.t3.micro"</span>
  name                  ~|<span class="o">=</span>| <span class="s2">"my~|-|db~|-|instance"</span> ~|#| 이것을 제거했다.
  username              ~|<span class="o">=</span>| <span class="s2">"Iam_user"</span>
  password              ~|<span class="o">=</span>| <span class="s2">"12345678"</span>
</code></pre></div></div>

<p><img src="/assets/img/Terraform/rdsSuccess.png" alt="rds" /></p>

<h2 id="step-4-애플리케이션-로드-밸런서-및-auto-scaling-group-적용">STEP 4: 애플리케이션 로드 밸런서 및 Auto Scaling Group 적용</h2>

<p>Auto Scaling Group은 최소 2개, 최대 10개로 설정해 놓습니다.</p>

<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FvcF58%2FbtrPQylUByK%2FDnXLbuvUucsF7Juyp2KraK%2Fimg.png" alt="Alt text" /></p>

<p>작성된 주요 리소스는 다음과 같습니다.</p>

<p>auto scaling이 관리하는 EC2 Instance를 alb가 자동으로 인식하여 트래픽을 부하분산합니다.</p>

<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcejJkj%2FbtrPQNpzO9a%2FQoy2f6N8vCkt2BtQHKq470%2Fimg.png" alt="img" /></p>

<p>ALB는 외부 요청을 받는 Listener와 Target group으로 구성됩니다. 그리고 Auto Scaling group이 Target group으로 연결하면 구성이 끝납니다.</p>

<p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fuj1XT%2FbtrPPwJvbTy%2FBCFRkpekd5pWB83C1X8g71%2Fimg.png" alt="img" /></p>

<p>Auto scaling group에서 Targer group연결할때는 Load balancing과 Health checks필드를 설정</p>

<p>AWS 콘솔 만들기를 통해 1:1로 비교해보고 코드를 작성해봅니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_alb"</span> <span class="s2">"myALB"</span> <span class="o">{</span>
  name ~|<span class="o">=</span>| <span class="s2">"my~|-|alb"</span>
  internal ~|<span class="o">=</span>| <span class="nb">false
  </span>load_balancer_type ~|<span class="o">=</span>| <span class="s2">"application"</span>
  security_groups ~|<span class="o">=</span>| <span class="o">[</span>aws_security_group.my~|-|public~|-|SG.id]
  subnets ~|<span class="o">=</span>| <span class="o">[</span>aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
  enable_cross_zone_load_balancing ~|<span class="o">=</span>| <span class="nb">true</span>
<span class="o">}</span>
</code></pre></div></div>
<p><img src="/assets/img/Terraform/LB.png" alt="lb" />
<img src="/assets/img/Terraform/LB2.png" alt="lb2" />
<img src="/assets/img/Terraform/LB3.png" alt="lb3" />
(사진으론 프라이빗이라고 돼있지만, 퍼블릭으로 선택해준다. )</p>

<p><img src="/assets/img/Terraform/sg1.png" alt="sg1" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~|#| alb.tf
resource <span class="s2">"aws_alb"</span> <span class="s2">"myALB"</span> <span class="o">{</span>
  name ~|<span class="o">=</span>| <span class="s2">"my~|-|alb"</span>
  internal ~|<span class="o">=</span>| <span class="nb">false
  </span>load_balancer_type ~|<span class="o">=</span>| <span class="s2">"application"</span>
  security_groups ~|<span class="o">=</span>| <span class="o">[</span>aws_security_group.my~|-|public~|-|SG.id]
  subnets ~|<span class="o">=</span>| <span class="o">[</span>aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
  enable_cross_zone_load_balancing ~|<span class="o">=</span>| <span class="nb">true</span>
<span class="o">}</span>

resource <span class="s2">"aws_autoscaling_group"</span> <span class="s2">"my~|-|ASG"</span> <span class="o">{</span>
  name                 ~|<span class="o">=</span>| <span class="s2">"my~|-|auto~|-|scaling~|-|group"</span>
  launch_configuration ~|<span class="o">=</span>| aws_launch_configuration.my~|-|lc.name
  min_size             ~|<span class="o">=</span>| 2
  max_size             ~|<span class="o">=</span>| 10
  desired_capacity     ~|<span class="o">=</span>| 2
  target_group_arns    ~|<span class="o">=</span>| <span class="o">[</span>aws_lb_target_group.my~|-|target~|-|group.arn]
  vpc_zone_identifier  ~|<span class="o">=</span>| <span class="o">[</span>aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
<span class="o">}</span>

resource <span class="s2">"aws_lb_target_group"</span> <span class="s2">"my~|-|target~|-|group"</span> <span class="o">{</span>
  name     ~|<span class="o">=</span>| <span class="s2">"my~|-|target~|-|group"</span>
  port     ~|<span class="o">=</span>| 80
  protocol ~|<span class="o">=</span>| <span class="s2">"HTTP"</span>
  vpc_id   ~|<span class="o">=</span>| aws_vpc.my~|-|vpc~|-|0515.id
<span class="o">}</span>

resource <span class="s2">"aws_launch_configuration"</span> <span class="s2">"my~|-|lc"</span> <span class="o">{</span>
  name                 ~|<span class="o">=</span>| <span class="s2">"my~|-|launch~|-|configuration"</span>
  image_id             ~|<span class="o">=</span>| <span class="s2">"ami~|-|0cb1d752d27600adb"</span>
  instance_type        ~|<span class="o">=</span>| <span class="s2">"t2.micro"</span>
  security_groups      ~|<span class="o">=</span>| <span class="o">[</span>aws_security_group.my~|-|public~|-|SG.id]
  key_name             ~|<span class="o">=</span>| aws_key_pair.ec2~|-|key.key_name
  associate_public_ip_address ~|<span class="o">=</span>| <span class="nb">true
  </span>user_data ~|<span class="o">=</span>| ~|&lt;|~|&lt;|~|-|EOF
    ~|#|!/bin/bash
    <span class="nb">echo</span> <span class="s2">"Hello, World"</span> <span class="o">&gt;</span> index.html
    <span class="nb">nohup </span>busybox httpd ~|-|f ~|-|p <span class="k">${</span><span class="nv">var</span><span class="p">.server_port</span><span class="k">}</span> &amp;
  EOF
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/img/Terraform/alb2.png" alt="alb" />
<img src="/assets/img/Terraform/alb3.png" alt="alb" />
<img src="/assets/img/Terraform/alb4.png" alt="alb" /></p>

<h3 id="오류-발생-1">오류 발생</h3>

<p>이제 <code class="language-plaintext highlighter-rouge">terraform destroy</code>를 통해 싸-악 날려버리면 그만인데, 오류 발생 ( 오히려 좋아 )</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╷
│ Error: final_snapshot_identifier is required when skip_final_snapshot is <span class="nb">false</span>
│ 
</code></pre></div></div>

<h3 id="오류-해결-2">오류 해결</h3>

<p>리소스를 제거하는 과정에서 최종 스냅샷과 관련된 문제가 있는 것으로 보입니다. 오류는 <code class="language-plaintext highlighter-rouge">skip_final_snapshot</code> 옵션이 <code class="language-plaintext highlighter-rouge">false</code>로 설정된 경우 최종 스냅샷 식별자가 필요하다고 나와 있습니다.</p>

<p>이 오류를 해결하기 위해서는 Terraform 구성에서 <code class="language-plaintext highlighter-rouge">RDS 인스턴스 리소스 (aws_db_instance.my-rds)</code>에 <code class="language-plaintext highlighter-rouge">final_snapshot_identifier</code> 인자를 명시해야 합니다. 이 인자는 RDS 인스턴스가 제거되기 전에 생성될 최종 스냅샷의 이름을 결정합니다.</p>

<p>다음은 RDS 인스턴스 리소스를 업데이트하여 final_snapshot_identifier 인자를 포함하는 예시(<strong>최종 스냅샷을 생성하는 방법</strong>)입니다:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
  // 다른 구성 옵션

  final_snapshot_identifier ~|<span class="o">=</span>| <span class="s2">"my~|-|rds~|-|final~|-|snapshot"</span>
<span class="o">}</span>
</code></pre></div></div>
<p>이후에 terraform apply를 실행하여 변경 사항을 적용하세요.</p>

<p>혹은 aws_db_instance.my-rds 리소스에 skip_final_snapshot 옵션을 true로 설정하여 스냅샷을 건너뛸 수 있습니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource <span class="s2">"aws_db_instance"</span> <span class="s2">"my~|-|rds"</span> <span class="o">{</span>
  // 다른 구성 옵션
  
   skip_final_snapshot ~|<span class="o">=</span>| <span class="nb">true</span>
<span class="o">}</span>
</code></pre></div></div>
<p>이후에 terraform apply를 실행하여 변경 사항을 적용하세요.</p>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/%EA%B9%83%ED%97%88%EB%B8%8C-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">
                                    
                                        <img src="https://res.cloudinary.com/dvqcvocet/image/upload/v1681139412/dev-jeans_v2eutk.png">
                                    
                                    <h3>깃허브 블로그 만들기</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/review2/">
                                    
                                        <img src="https://assets.quizlet.com/a/j/dist/app/i/brandmark/1024.0e9431247202b7b.png">
                                    
                                    <h3>데브옵스 총정리 퀴즈 2</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/loadTest/">
                                    
                                        <img src="https://s3.ap-northeast-2.amazonaws.com/urclass-images/vAZ96HI84yghJWvZ4weBg-1638317071798.png">
                                    
                                    <h3>성능 및 부하 테스트 II - Load Test</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="16">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <div class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    
    <a href="/k8s/" class="post-preview">
        <div class="image">
            
                <img src="https://res.cloudinary.com/dvqcvocet/image/upload/v1684335849/%E1%84%8F%E1%85%AE%E1%84%87%E1%85%A5%E1%84%8C%E1%85%B5%E1%86%AB%E1%84%89%E1%85%B3_yoqeyy.png">
            
        </div>
        <h3 class="title">Kubernetes( k8s )</h3>
    </a>
</div>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Terraform으로 AWS 서비스 구축하기 - EC2 RDS S3 구축 (1)&quot;%20http://localhost:4000/Terraform-AWS/%20via%20&#64;&hashtags=terraform,테라폼,IaC"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Terraform-AWS/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'hoonology';
        var disqus_title = '';
        var disqus_url = '/Terraform-AWS/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/hoonology" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
      
      
      
        <a href="https://www.instagram.com/ho.o_ny" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
    </p>

    <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/about">About</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/docker">Docker</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/aws">AWS</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/cicd">CICD</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/msa">MSA</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/terraform">Terraform</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/mornitoring">Mornitoring</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/k8s">k8s</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/project">Project</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/review">review</a>
      </li>
    
  
</ul>


    <!-- <p>
      <span>Jekflix</span> was made with <svg class="love"><use xlink:href="#icon-heart"></use></svg> by <a href="https://rossener.com" target="_blank" class="creator">Thiago Rossener</a>
    </p> -->
</footer>









<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Hoonology",
  "description": "Hoonology changes whole world.",
  "url": "http://localhost:4000/",
  "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4000/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/hoonology","https://www.instagram.com/ho.o_ny"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JJ0MLGN5R6"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-JJ0MLGN5R6');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "(Sprint) Full Stack 애플리케이션 구성",
            "headline": "Terraform",
            "description": "Terraform으로 AWS 서비스 구축하기 - EC2 RDS S3 구축 (1)",
            "image": "https://res.cloudinary.com/dvqcvocet/image/upload/v1683864943/dev-jeans_kadf7q.png",
            "url": "http://localhost:4000/Terraform-AWS/",
            "articleBody": "요구사항

다음의 아키텍처를 terraform을 이용해 작성합니다.


Getting Started

IaC 코드를 작성하려면 먼저 AWS Management Console을 이용해 먼저 최종 인프라 상태를 만들어놓고, 잘 작동하는지 확인한 다음, 이를 해당하는 리소스를 하나씩 코드로 옮기는 방법을 사용하는 방식을 사용해 보면 좋습니다.

다음 자습서를 순서대로 따라 합니다. 먼저 AWS Management Console을 통해 최종 결과물을 따라 해보고, 예상 상태가 무엇인지 먼저 파악해야 합니다.

모든 리소스를 만들 때에는 반드시 이름을 붙여놓도록 합시다.

STEP 1: 자습서: DB 인스턴스에 사용할 Amazon VPC 생성

링크


1. VPC 및 서브넷 생성


  프라이빗 서브넷과 퍼블릭 서브넷이 각각 두 개, 총 네 개가 있어야 합니다.


프라이빗 서브넷과 퍼블릭 서브넷을 포함하는 VPC 생성

다음은 퍼블릭 서브넷과 프라이빗 서브넷을 모두 포함하는 VPC를 생성하는 절차입니다.


  VPC 및 서브넷을 생성하는 방법
    
      Amazon VPC 콘솔을 엽니다
      AWS Management Console의 오른쪽 상단에서 VPC를 생성할 리전을 선택합니다. 이 예에서는 미국 서부(오레곤) 리전을 사용합니다.
      왼쪽 상단 모서리에서 VPC 대시보드를 선택합니다. VPC 생성을 시작하려면 VPC 생성을 선택합니다.
      VPC 설정의 생성할 리소스에서 VPC 등을 선택합니다.
      VPC 설정을 위해 다음 값을 설정합니다.
        
          네임 태그 자동 생성 - tutorial
          IPv4 CIDR block: - 10.0.0.0/16
            
              이 블록은 10.0.0.0에서 10.0.255.255까지의 IP 주소 범위를 제공한다.
            
          
          IPv6 CIDR 블록 - No IPv6 CIDR Block(IPv6 CIDR 블록 없음)
          테넌시 - 기본값
        
      
      서브넷
        
          프라이빗 서브넷을 만들고 싶기 때문에 각 프라이빗 서브넷에 대해 /24 CIDR 블록을 사용하는 것이 일반적입니다.
        
      
    

    
    
      가용 영역(AZ)의 수 - 2
      Customize AZs(AZ 사용자 지정) - 기본값을 유지합니다.
      퍼블릭 서브넷 수 – 2
      프라이빗 서브넷 수 – 2
      
        Customize subnets CIDR blocks(서브넷 CIDR 블록 사용자 지정) - 기본값을 유지합니다.





      
      NAT 게이트웨이($) – 없음
        
          NAT 게이트웨이는 퍼블릭 서브넷이 아닌 프라이빗 서브넷의 리소스에 대한 인터넷 액세스를 제공하는 데 사용됩니다. 반면에 인터넷 게이트웨이는 퍼블릭 서브넷의 리소스가 인터넷에 직접 액세스할 수 있도록 합니다.
        
      
      VPC 엔드포인트 – 없음
      DNS options(DNS 옵션) - 기본값을 유지합니다.
    
  


1-2. 위 과정이 잘 안된다면 테라폼으로 작성해본다.

provider.tf 파일 생성
terraform {
  required_version ~|=| &quot;&amp;gt;~|=| 0.14.8&quot; 

  required_providers {
      aws ~|=| {
          source ~|=| &quot;hashicorp/aws&quot;
          version ~|=| &quot;~&amp;gt; 3.0&quot;
      }
  }
}

provider &quot;aws&quot; {
  region     ~|=| &quot;ap~|-|northeast~|-|2&quot;
  ~|#| access_key 와 secert_key 를 파일에 적어서 구현할 수는 있지만 권장하지 않습니다.
  ~|#| access_key ~|=| &quot;my~|-|access~|-|key&quot;
  ~|#| secret_key ~|=| &quot;my~|-|secret~|-|key&quot;
}


초기화
terraform init ~|-|upgrade

plan은 실제로 리소스를 작성하기 전 리소스가 어떻게 생성되는지를 확인하는 명령어입니다.

~|#| vpc.tf
resource &quot;aws_vpc&quot; &quot;my~|-|vpc~|-|0515&quot; {
  cidr_block ~|=| &quot;10.0.0.0/16&quot;

~|#| 네임태그
  tags ~|=| {
    Name ~|=| &quot;my~|-|vpc~|-|0515&quot;
  }
}


terraform plan



CloudFormation의 create-change-set , execute-change-set 조합과 같습니다.

단순하게 plan 명령어만 입력하면 되기 때문에 CloudFormation을 사용하는 것보다 훨씬 빠르고 편하게 결과를 예측할 수 있습니다.



이제 AWS 콘솔로 가서 VPC에서 네임태그와 함께 올라가있는지 확인해줍니다.


1-3. 서브넷 작성

EC2에 사용할 2개의 퍼블릭 서브넷과 RDS에 사용할 2개의 프라이빗 서브넷을 작성

(파일은 사용자가 나누고 싶은대로 나눕니다.)

resource &quot;aws_subnet&quot; &quot;PublicSubnet01&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|=| &quot;10.0.1.0/24&quot;
  availability_zone ~|=| &quot;ap~|-|northeast~|-|2a&quot;
  tags ~|=| {
    Name ~|=| &quot;public~|-|subnet01&quot;
  }
}

resource &quot;aws_subnet&quot; &quot;PublicSubnet02&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|=| &quot;10.0.2.0/24&quot;
  availability_zone ~|=| &quot;ap~|-|northeast~|-|2c&quot; ~|#| b는 t2 micro 적용이 안된다.
  tags ~|=| {
    Name ~|=| &quot;public~|-|subnet02&quot;
  }
}
resource &quot;aws_subnet&quot; &quot;PrivateSubnet01&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|=| &quot;10.0.3.0/24&quot;
  availability_zone ~|=| &quot;ap~|-|northeast~|-|2a&quot;
  tags ~|=| {
    Name ~|=| &quot;private~|-|subnet01&quot;
  }
}
resource &quot;aws_subnet&quot; &quot;PrivateSubnet02&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  cidr_block ~|=| &quot;10.0.4.0/24&quot;
  availability_zone ~|=| &quot;ap~|-|northeast~|-|2c&quot;
  tags ~|=| {
    Name ~|=| &quot;private~|-|subnet02&quot;
  }
}


1-4. 인터넷게이트웨이 (IGW) 작성

인터넷 게이트웨이는 VPC에 연결하여 VPC가 인터넷과 통신할 수 있도록 해줍니다.

resource &quot;aws_internet_gateway&quot; &quot;my~|-|IGW~|-|0515&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  tags ~|=| {
    Name ~|=| &quot;my~|-|IGW~|-|0515&quot;
  }
}


1-5. 라우팅테이블 작성

VPC를 생성하면 기본 라우팅 테이블이 함께 만들어집니다. 하지만 VPC를 보호하기 위해 기본 라우팅 테이블은 초기 설정을 그대로 두고 사용하지 않는 것을 권장합니다.

라우팅 테이블을 작성하고 이를 서브넷과 연결해줍니다.
resource &quot;aws_route_table&quot; &quot;my~|-|public~|-|route01&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  route {
    cidr_block ~|=| &quot;0.0.0.0/0&quot;
    gateway_id ~|=| aws_internet_gateway.my~|-|IGW~|-|0515.id
  }
  tags ~|=| {
    Name ~|=| &quot;my~|-|public~|-|route01&quot;
  }
}
resource &quot;aws_route_table&quot; &quot;my~|-|public~|-|route02&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  route {
    cidr_block ~|=| &quot;0.0.0.0/0&quot;
    gateway_id ~|=| aws_internet_gateway.my~|-|IGW~|-|0515.id
  }
  tags ~|=| {
    Name ~|=| &quot;my~|-|public~|-|route02&quot;
  }
}

~|#|~|#| 2. 프라이빗 라우팅 테이블 정의
resource &quot;aws_route_table&quot; &quot;my~|-|private~|-|route01&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id

  tags ~|=| {
    Name ~|=| &quot;my~|-|private~|-|route01&quot;
  }
}
resource &quot;aws_route_table&quot; &quot;my~|-|private~|-|route02&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id

  tags ~|=| {
    Name ~|=| &quot;my~|-|private~|-|route02&quot;
  }
}

~|#|~|#| 퍼블릭 라우팅 테이블 연결
resource &quot;aws_route_table_association&quot; &quot;my~|-|public~|-|RT~|-|Assoication01&quot; {
  subnet_id ~|=| aws_subnet.PublicSubnet01.id
  route_table_id ~|=| aws_route_table.my~|-|public~|-|route01.id
}
resource &quot;aws_route_table_association&quot; &quot;my~|-|public~|-|RT~|-|Assoication02&quot; {
  subnet_id ~|=| aws_subnet.PublicSubnet02.id
  route_table_id ~|=| aws_route_table.my~|-|public~|-|route02.id
}

~|#|~|#| 프라이빗 라우팅 테이블 연결
resource &quot;aws_route_table_association&quot; &quot;my~|-|private~|-|RT~|-|Assoication01&quot; {
  subnet_id ~|=| aws_subnet.PrivateSubnet01.id
  route_table_id ~|=| aws_route_table.my~|-|private~|-|route01.id
}
resource &quot;aws_route_table_association&quot; &quot;my~|-|private~|-|RT~|-|Assoication02&quot; {
  subnet_id ~|=| aws_subnet.PrivateSubnet02.id
  route_table_id ~|=| aws_route_table.my~|-|private~|-|route02.id
}


2. VPC 보안 그룹 생성


  퍼블릭 웹 서버가 사용할 VPC 보안 그룹을 만들어야 합니다.
  프라이빗 DB 웹 서버가 사용할 VPC 보안 그룹을 만들어야 합니다.


~|#|~|#| 퍼블릭 보안 그룹
resource &quot;aws_security_group&quot; &quot;my~|-|public~|-|SG&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  name ~|=| &quot;my public SG&quot;
  description ~|=| &quot;my public SG&quot;
  tags ~|=| {
    Name ~|=| &quot;log public SG&quot;
  }
}

~|#|~|#| 프라이빗 보안 그룹
resource &quot;aws_security_group&quot; &quot;my~|-|private~|-|SG&quot; {
  vpc_id ~|=| aws_vpc.my~|-|vpc~|-|0515.id
  name ~|=| &quot;my private SG&quot;
  description ~|=| &quot;private SG&quot;
  tags ~|=| {
    Name ~|=| &quot;log private SG&quot;
  }
}

~|#|~|#| 퍼블릭 보안 그룹 규칙
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|HTTPingress&quot; {
  type ~|=| &quot;ingress&quot;
  from_port ~|=| 80
  to_port ~|=| 80
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;0.0.0.0/0&quot; ]
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|HTTPegress&quot; {
  type ~|=| &quot;egress&quot;
  from_port ~|=| 80
  to_port ~|=| 80
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;0.0.0.0/0&quot; ]
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|HTTPSingress&quot; {
  type ~|=| &quot;ingress&quot;
  from_port ~|=| 443
  to_port ~|=| 443
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;0.0.0.0/0&quot; ]
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|HTTPSegress&quot; {
  type ~|=| &quot;egress&quot;
  from_port ~|=| 443
  to_port ~|=| 443
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;0.0.0.0/0&quot; ]
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|SSHingress&quot; {
  type ~|=| &quot;ingress&quot;
  from_port ~|=| 22
  to_port ~|=| 22
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|/32&quot; ] ~|#| your IP
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|public~|-|SG~|-|Rules~|-|SSHegress&quot; {
  type ~|=| &quot;egress&quot;
  from_port ~|=| 22
  to_port ~|=| 22
  protocol ~|=| &quot;TCP&quot;
  cidr_blocks ~|=| [ &quot;~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|~|-|~|-|.~|-|/32&quot; ] ~|#| your IP
  security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}

~|#|~|#|~|#| 프라이빗 보안 그룹 규칙 ( RDS )
resource &quot;aws_security_group_rule&quot; &quot;my~|-|private~|-|SG~|-|Rules~|-|RDSingress&quot; {
  type ~|=| &quot;ingress&quot;
  from_port ~|=| 3306
  to_port ~|=| 3306
  protocol ~|=| &quot;TCP&quot;
  security_group_id ~|=| aws_security_group.my~|-|private~|-|SG.id
  source_security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}
resource &quot;aws_security_group_rule&quot; &quot;my~|-|private~|-|SG~|-|Rules~|-|RDSegress&quot; {
  type ~|=| &quot;egress&quot;
  from_port ~|=| 3306
  to_port ~|=| 3306
  protocol ~|=| &quot;TCP&quot;
  security_group_id ~|=| aws_security_group.my~|-|private~|-|SG.id
  source_security_group_id ~|=| aws_security_group.my~|-|public~|-|SG.id
  lifecycle {
    create_before_destroy ~|=| true
  }
}







3. DB 서브넷 그룹 생성


  RDS 인스턴스가 사용할 VPC 서브넷 그룹을 만들어야 합니다.


STEP 2: EC2 인스턴스 생성

만들어야 하는 사양은 다음과 같습니다.

  키 페어: 수동으로 만들고 EC2에 할당합니다.
  AMI: Ubuntu Server 18
  인스턴스 타입: t2.micro
  사용자 데이터
    ~|#|!/bin/bash
echo &quot;Hello, World&quot; &amp;gt; index.html
nohup busybox httpd ~|-|f ~|-|p ${var.server_port} &amp;amp;
    
  


1. 키페어 생성


  키 페어 할당
    ssh~|-|keygen ~|-|t rsa ~|-|b 4069 ~|-|C {자신의 메일} ~|-|f &quot;./testPubkey&quot; ~|-|N &quot;&quot;
    
    디렉토리에 testPubkey 라고 명명한 키 페어 파일이 생성된다.
  


2. EC2 생성

ec2.tf 작성
  resource &quot;aws_key_pair&quot; &quot;ec2_key&quot; {
    key_name ~|=| &quot;terraTest&quot;
    public_key ~|=| file(&quot;./testPubkey.pub&quot;)
  }

퍼블릭키 지정 2가지 방법

  file로 지정
  공개키 ssh-rsa 값


3. 인스턴스 생성

https://cloud-images.ubuntu.com/locator/ec2/
내 리전에 맞는 EC2 ami id를 찾아서 값을 대입한다.

resource &quot;aws_instance&quot; &quot;test_ec2&quot; {
  ami ~|=| &quot;ami~|-|0da3b51b79ece2d3d&quot;
  instance_type ~|=| &quot;t2.micro&quot;
  vpc_security_group_ids ~|=| [ 
    aws_security_group.my~|-|public~|-|SG.id,
   ]
  subnet_id ~|=| aws_subnet.PublicSubnet01.id
  key_name ~|=| aws_key_pair.ec2_key.key_name
  root_block_device {
    volume_size ~|=| 200
    volume_type ~|=| &quot;gp3&quot;
  }
}

위와 같이 작성 후 plan을 실행해본다.



사용자 데이터를 넣어서 ec2.tf 파일을 완성시킨다.

variable &quot;server_port&quot; {
  description ~|=| &quot;The port number for the HTTP server&quot;
  type        ~|=| number
  default     ~|=| 8080
}

resource &quot;aws_key_pair&quot; &quot;ec2_key&quot; {
  key_name   ~|=| &quot;terraTest&quot;
  public_key ~|=| file(&quot;./testPubkey.pub&quot;)
}

resource &quot;aws_instance&quot; &quot;test_ec2&quot; {
  ami                    ~|=| &quot;ami~|-|0da3b51b79ece2d3d&quot;
  instance_type          ~|=| &quot;t2.micro&quot;
  vpc_security_group_ids ~|=| [aws_security_group.my~|-|public~|-|SG.id]
  subnet_id              ~|=| aws_subnet.PublicSubnet01.id
  key_name               ~|=| aws_key_pair.ec2_key.key_name

  root_block_device {
    volume_size ~|=| 200
    volume_type ~|=| &quot;gp3&quot;
  }

  user_data ~|=| ~|&amp;lt;|~|&amp;lt;|~|-|EOF
    ~|#|!/bin/bash
    echo &quot;Hello, World&quot; &amp;gt; index.html
    nohup busybox httpd ~|-|f ~|-|p ${var.server_port} &amp;amp;
  EOF
}


이제 terraform apply를 실행해본다.

오류발생

│ Error: Error launching source instance: InvalidParameterValue: The architecture 
|&apos;i386,x86_64&apos; of the specified instance type does not match the architecture &apos;arm64&apos; of 
|the specified AMI. Specify an instance type and an AMI that have matching architectures,
| and try again. You can use &apos;describe~|-|instance~|-|types&apos; or &apos;describe~|-|images&apos; to discover
| the architecture of the instance type or AMI.
│       status code: 400, request id: 48898fa9~|-|1f54~|-|4ab4~|-|b7b8~|-|81b3063cfb7e
│ 
│   with aws_instance.test_ec2,
│   on ec2.tf line 12, in resource &quot;aws_instance&quot; &quot;test_ec2&quot;:
│   12: resource &quot;aws_instance&quot; &quot;test_ec2&quot; {

오류 해결


  오류 내용 : 오류 메시지는 지정된 인스턴스 유형의 아키텍처와 사용하려는 AMI의 아키텍처 간에 불일치가 있음을 나타냅니다. 인스턴스 유형은 ‘i386’ 또는 ‘x86_64’의 아키텍처를 예상하지만 제공한 AMI의 아키텍처는 ‘arm64’입니다.



  https://cloud-images.ubuntu.com/locator/ec2/ 사이트에서 내가 찾은 ami id가 arm64 기반으로 구성된 ubuntu18.04LTS라서 발생한 문제 같다.


Ami ID를 “ami-0cb1d752d27600adb”로 바꿔줬더니 Apply가 성공했다.


Reference

https://dev.classmethod.jp/articles/build-multiple-services-with-terraform-04/

STEP 3: RDS 생성

RDS에 서브넷을 지정하기 위해선 1개의 서브넷만 필요하더라도 서브넷 그룹으로 지정해야합니다.
서브넷 그룹을 작성한 후 aws_db_instance리소스를 이용하여 RDS를 생성합니다.

resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
  allocated_storage     ~|=| 20
  engine                ~|=| &quot;mysql&quot;
  engine_version        ~|=| &quot;8.0.23&quot;
  instance_class        ~|=| &quot;db.t3.micro&quot;
  name                  ~|=| &quot;my~|-|db~|-|instance&quot;
  username              ~|=| &quot;Iam_user&quot;
  password              ~|=| &quot;12345678&quot;

~|#| Storage ( 스토리지 섹션 기본 값으로 설정 )
  ~|#| No changes, keeping the default values

  ~|#| Connections
  ~|#| No changes, keeping the default values

  ~|#| Compute resource
  ~|#| No changes, as the connection is established using depends_on

  depends_on ~|=| [aws_instance.my~|-|ec2]
}


depends_on = [aws_instance.my-ec2]를 추가하면 RDS 인스턴스 생성이 EC2 인스턴스 생성에 따라 달라져 EC2 인스턴스가 RDS 인스턴스보다 먼저 생성되도록 합니다.

오류 발생

 with aws_db_instance.my~|-|rds,
   on rds.tf line 1, in resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot;:
    1: resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
 

오류 해결

resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
  allocated_storage     ~|=| 20
  engine                ~|=| &quot;mysql&quot;
  engine_version        ~|=| &quot;8.0.32&quot;
  instance_class        ~|=| &quot;db.t3.micro&quot;
  username              ~|=| &quot;Iam_user&quot;
  password              ~|=| &quot;12345678&quot;

~|#| Storage ( 스토리지 섹션 기본 값으로 설정 )
  ~|#| No changes, keeping the default values

  ~|#| Connections
  ~|#| No changes, keeping the default values

  ~|#| Compute resource
  ~|#| No changes, as the connection is established using depends_on

  depends_on ~|=| [aws_instance.my~|-|ec2]
    ~|#| Specify the subnet IDs for the RDS instance
  db_subnet_group_name ~|=| aws_db_subnet_group.default.name
}

resource &quot;aws_db_subnet_group&quot; &quot;default&quot; {
  name        ~|=| &quot;default~|-|subnet~|-|group&quot;
  description ~|=| &quot;Default subnet group for RDS&quot;
  subnet_ids  ~|=| [
    aws_subnet.PrivateSubnet01.id,
    aws_subnet.PrivateSubnet02.id,
  ]
  tags ~|=| {
    Name ~|=| &quot;DefaultSubnetGroup&quot;
  }
}


어떻게 해결했는가
resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
  allocated_storage     ~|=| 20
  engine                ~|=| &quot;mysql&quot;
  engine_version        ~|=| &quot;8.0.23&quot;
  instance_class        ~|=| &quot;db.t3.micro&quot;
  name                  ~|=| &quot;my~|-|db~|-|instance&quot; ~|#| 이것을 제거했다.
  username              ~|=| &quot;Iam_user&quot;
  password              ~|=| &quot;12345678&quot;




STEP 4: 애플리케이션 로드 밸런서 및 Auto Scaling Group 적용

Auto Scaling Group은 최소 2개, 최대 10개로 설정해 놓습니다.



작성된 주요 리소스는 다음과 같습니다.

auto scaling이 관리하는 EC2 Instance를 alb가 자동으로 인식하여 트래픽을 부하분산합니다.



ALB는 외부 요청을 받는 Listener와 Target group으로 구성됩니다. 그리고 Auto Scaling group이 Target group으로 연결하면 구성이 끝납니다.



Auto scaling group에서 Targer group연결할때는 Load balancing과 Health checks필드를 설정

AWS 콘솔 만들기를 통해 1:1로 비교해보고 코드를 작성해봅니다.

resource &quot;aws_alb&quot; &quot;myALB&quot; {
  name ~|=| &quot;my~|-|alb&quot;
  internal ~|=| false
  load_balancer_type ~|=| &quot;application&quot;
  security_groups ~|=| [aws_security_group.my~|-|public~|-|SG.id]
  subnets ~|=| [aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
  enable_cross_zone_load_balancing ~|=| true
}




(사진으론 프라이빗이라고 돼있지만, 퍼블릭으로 선택해준다. )



~|#| alb.tf
resource &quot;aws_alb&quot; &quot;myALB&quot; {
  name ~|=| &quot;my~|-|alb&quot;
  internal ~|=| false
  load_balancer_type ~|=| &quot;application&quot;
  security_groups ~|=| [aws_security_group.my~|-|public~|-|SG.id]
  subnets ~|=| [aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
  enable_cross_zone_load_balancing ~|=| true
}

resource &quot;aws_autoscaling_group&quot; &quot;my~|-|ASG&quot; {
  name                 ~|=| &quot;my~|-|auto~|-|scaling~|-|group&quot;
  launch_configuration ~|=| aws_launch_configuration.my~|-|lc.name
  min_size             ~|=| 2
  max_size             ~|=| 10
  desired_capacity     ~|=| 2
  target_group_arns    ~|=| [aws_lb_target_group.my~|-|target~|-|group.arn]
  vpc_zone_identifier  ~|=| [aws_subnet.PublicSubnet01.id, aws_subnet.PublicSubnet02.id]
}

resource &quot;aws_lb_target_group&quot; &quot;my~|-|target~|-|group&quot; {
  name     ~|=| &quot;my~|-|target~|-|group&quot;
  port     ~|=| 80
  protocol ~|=| &quot;HTTP&quot;
  vpc_id   ~|=| aws_vpc.my~|-|vpc~|-|0515.id
}

resource &quot;aws_launch_configuration&quot; &quot;my~|-|lc&quot; {
  name                 ~|=| &quot;my~|-|launch~|-|configuration&quot;
  image_id             ~|=| &quot;ami~|-|0cb1d752d27600adb&quot;
  instance_type        ~|=| &quot;t2.micro&quot;
  security_groups      ~|=| [aws_security_group.my~|-|public~|-|SG.id]
  key_name             ~|=| aws_key_pair.ec2~|-|key.key_name
  associate_public_ip_address ~|=| true
  user_data ~|=| ~|&amp;lt;|~|&amp;lt;|~|-|EOF
    ~|#|!/bin/bash
    echo &quot;Hello, World&quot; &amp;gt; index.html
    nohup busybox httpd ~|-|f ~|-|p ${var.server_port} &amp;amp;
  EOF
}






오류 발생

이제 terraform destroy를 통해 싸-악 날려버리면 그만인데, 오류 발생 ( 오히려 좋아 )

╷
│ Error: final_snapshot_identifier is required when skip_final_snapshot is false
│ 


오류 해결

리소스를 제거하는 과정에서 최종 스냅샷과 관련된 문제가 있는 것으로 보입니다. 오류는 skip_final_snapshot 옵션이 false로 설정된 경우 최종 스냅샷 식별자가 필요하다고 나와 있습니다.

이 오류를 해결하기 위해서는 Terraform 구성에서 RDS 인스턴스 리소스 (aws_db_instance.my-rds)에 final_snapshot_identifier 인자를 명시해야 합니다. 이 인자는 RDS 인스턴스가 제거되기 전에 생성될 최종 스냅샷의 이름을 결정합니다.

다음은 RDS 인스턴스 리소스를 업데이트하여 final_snapshot_identifier 인자를 포함하는 예시(최종 스냅샷을 생성하는 방법)입니다:

resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
  // 다른 구성 옵션

  final_snapshot_identifier ~|=| &quot;my~|-|rds~|-|final~|-|snapshot&quot;
}

이후에 terraform apply를 실행하여 변경 사항을 적용하세요.

혹은 aws_db_instance.my-rds 리소스에 skip_final_snapshot 옵션을 true로 설정하여 스냅샷을 건너뛸 수 있습니다.

resource &quot;aws_db_instance&quot; &quot;my~|-|rds&quot; {
  // 다른 구성 옵션
  
   skip_final_snapshot ~|=| true
}

이후에 terraform apply를 실행하여 변경 사항을 적용하세요.
",
            "wordcount": "2986",
            "inLanguage": "ko",
            "dateCreated": "2023-05-15/",
            "datePublished": "2023-05-15/",
            "dateModified": "2023-05-15/",
            "author": {
                "@type": "Person",
                "name": "Mr. Anderson",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "The One",
                "url": "http://localhost:4000/authors/mranderson/",
                "sameAs": [
                    "https://github.com/github_username","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/linkedin_username"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "Hoonology",
                "url": "http://localhost:4000/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "http://localhost:4000/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "terraform",
            "articleSection": "terraform",
            "keywords": ["terraform","테라폼","IaC"]
        }
        </script>
       </body>
</html>
