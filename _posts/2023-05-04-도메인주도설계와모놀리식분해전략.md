---
date: 2023-05-04 00:00:00
layout: post
title: 도메인 주도 설계와 모놀리식 분해 전략
subtitle: Domain Driven Design
description: 아키텍처 구성의 변화 및 마이크로 서비스 소개
image: https://res.cloudinary.com/dvqcvocet/image/upload/v1683088696/m8krc7ci1vzzbl7sxeac.png
optimized_image: https://res.cloudinary.com/dvqcvocet/image/upload/v1683088696/m8krc7ci1vzzbl7sxeac.png
category: msa
tags:  
  - 도메인주도설계
  - 모놀리식 분해 전략
  - Domain Driven Design
author: Hoonology
paginate: true
---

# 도메인
- 도메인 지식 : 어떤 산업 또는 분야를 이해하기 위해 필요한 지식
- 도메인 
  - 지식, 영향력, 또는 활동 영역
  - 개발분야에서는, 소프트웨어로 해결하려는 문제의 영역을 의미한다.

- 도메인모델 : 객체지향 프로그래밍 - 상태(Property)와 동작(Method)로 나뉜다. ( **클래스** )
> 객체지향 프로그래밍에서는 도메인이 **클래스**로 표현

## 특정 도메인을 개념적으로 표현하는 방법 ( 객체지향 설계, ERD 등 )

도메인 기반 디자인에서 Eric Evans는 도메인 논리를 모델링하기 위한 두 가지 기본 개념인
**값 개체(Value Object)**와 **엔터티(Entity)**를 식별했습니다.  

> **값 개체**는 도메인 내의 특정 개념 또는 값을 나타내는 개체입니다. 값 개체는 변경할 수 없습니다. **즉, 일단 생성되면 해당 값을 변경할 수 없습니다**. 값 개체의 예로는 날짜, 통화 금액 또는 지리적 좌표와 같은 항목이 포함될 수 있습니다. 이러한 개체는 일반적으로 작고 단순하며 보다 복잡한 도메인 모델의 빌딩 블록으로 자주 사용됩니다.  

> **엔터티**는 도메인 내에서 고유한 ID를 나타내는 개체입니다. 엔터티에는 ID가 있습니다. 즉, 동일한 속성 값을 가진 두 엔터티가 ID가 다른 경우 여전히 구별되는 것으로 간주됩니다. 엔터티에는 일반적으로 연결된 동작이 있으며 시간이 지남에 따라 변경될 수 있습니다. 엔터티의 예로는 고객, 주문 또는 송장과 같은 항목이 포함될 수 있습니다.

![micro](/assets/img/MicroService/domian.png)


## 도메인 주도 설계 ( Domain Driven Design )
**도메인 내부에서 문제 해결이 가능한 형태로 도메인을 모델링하는 기법** ( 마이크로 서비스와 잘 맞는 조합 )
- 하나의 도메인 모델에 대한 이해관계가 각자 다름을 인정
- 각 팀에 적합한 하위 도메인(주문, 배달, 결제 등)을 설정
- 하위 도메인에 대한 맥락을 알고 있는 사람이 따라야할 비즈니스 규칙에 대한 경계 설정

![micro2](/assets/img/MicroService/domain3.png)

### 도메인 주도 설계 주요 용어
- 보편언어(ubiquitous language)
- 한정된 맥락(bounded context)

### 보편언어( ubiquitous language )
도메인의 특정 업무와 관련된 사람들 사이에서 통용되는 개념 ( 공유 언어 )  
 오해를 줄이는 데 도움이 되고 모든 이해 관계자가 도메인 개념과 그 관계를 명확하게 이해할 수 있도록 하기 때문에 중요하다.  
 유비쿼터스 언어는 도메인 개념을 기반으로 해야 하며, 도메인과 관련된 모든 통신 및 문서화에 사용되어야 한다.

![micro4](/assets/img/MicroService/domain4.png)

### 한정된 맥락 ( bounded context )

" 한 수강생이 교육을 듣는다 "

![micro5](/assets/img/MicroService/domain5.png)

#### 위 조건을 모놀리틱(단일 프로그램 ) 아키텍처로 구성하면 ?
  - 클래스 명명 규칙 설정의 어려움이 온다.
  - 클래스가 매우 커질 우려가 있다. ( 클래스는 하나의 책임만 가져야한다라는 책임 원칙 위배 )
  - 다른 목적을 갖도록 클래스를 분리한다고 해도 의존 관계를 신경 써야한다.

**불안한 징조**

![micro6](/assets/img/MicroService/domain6.png)

**Why ?**  

![micro7](/assets/img/MicroService/domain7.png)
![micro8](/assets/img/MicroService/domain8.png)
![micro9](/assets/img/MicroService/domain9.png)
![micro10](/assets/img/MicroService/domain10.png)

마이크로서비스 아키텍처는 DDD를 실천하기 위한 방법 중 하나이며 DDD의 유일한 해결책이 아님

### DDD 실천에 딱 맞는 마이크로서비스 아키텍처 
- 유지보수에 유리하고 테스트 가능해야함
- 느슨하게 결합되어야 함
- 독립적으로 배포 가능함
- 비즈니스 역량을 중심으로 구성
- 작은 팀에 의해 소유

도입하고자 한다면
1. 도메인 지식을 가진 엔지니어가 팀마다 있어야한다.
2. 여러 서비스가 잘 결합할 수 있게 디자인해야 한다.
3. 서비스를 오케스트레이션 해야한다.( 트래픽 수용 가능 여부, 인프라 유지 보수 업무에만 집중 )



# Action Items
## 도메인 모델
- Eric Evans는 도메인 모델이 Value Object, 엔티티로 표현된다고 했습니다. 각각은 무슨 의미를 가지고, 어떻게 다른가요?
## 시나리오: 교육 상품의 구매와 교육과정 수강
- 강조된 부분이 왜 불안한 징조일까요?

> 강조 표시된 부분은 개발자가 SRP(Single Responsibility Principle)를 유지하는 동시에 비즈니스 로직이 제대로 구현되는지 확인하는 데 관심이 있기 때문에 불안의 표시입니다. 개발자는 과정을 수강하는 것과 제품을 구매하는 것의 유사성을 인식하지만 SRP를 위반하지 않도록 책임을 가장 잘 분리하는 방법에 대해 걱정합니다.  
- 기존의 설계대로 구현했을 경우 어떤 문제가 생길까요?
> Product와 Course 클래스를 분리하지 않고 기존 디자인을 구현하면 SRP를 위반하여 향후 코드 유지 및 수정이 더 어려워질 수 있습니다. 분리가 부족하면 각 클래스의 책임에 대한 혼란이 발생하여 잠재적으로 비즈니스 로직 구현에 오류가 발생할 수 있습니다.


## 마이크로서비스
- 데이터베이스를 꼭 분리해야 하나요? 한 곳에 모여있지 않고 중복되어도 괜찮은가요?  
- 상품 구매 서비스는 성공했는데, 수강 관리 서비스에서 실패해서 데이터가 안 들어가면 어떡하죠?
- 개발자가 도메인에 종속되어서 개발하면, 자율성이 줄어들지는 않을까요?

> 마이크로서비스 아키텍처를 구현할 때 일반적으로 각 마이크로서비스가 자체 데이터 저장소를 갖고 독립적으로 작동할 수 있도록 데이터베이스를 분리하는 것이 좋습니다. 서비스가 한곳에 그룹화되지 않고 겹치면 일관성 및 데이터 무결성 문제가 발생할 수 있습니다. 과정 관리 서비스의 장애로 인해 데이터가 입력되지 않는 경우 제품 구매 서비스는 이러한 장애를 처리하고 시스템이 복원력을 유지하도록 하는 메커니즘을 갖추어야 합니다.  

> 영역에 의존하는 개발은 자율성을 제한할 수 있지만 자율성과 조정 사이의 균형을 맞추는 것이 중요합니다. 전체 시스템이 결합되고 한 서비스에 대한 변경 사항이 다른 서비스에 부정적인 영향을 미치지 않도록 다른 팀 또는 서비스와 협력해야 할 수 있습니다. 그러나 도메인 기반 설계 원칙을 준수하고 서비스가 특정 비즈니스 기능에 집중되도록 함으로써 서비스 내에서 자율성을 유지하는 것은 여전히 ​​가능합니다.

<br>
<br>
<br>

# Sprint - 도메인 주도 설계 실습

도메인 주도 설계 실습을 진행하기 전 이벤트스토밍을 기법을 통한 진행방식에 대한 예시를 확인하겠습니다.

**이벤트 스토밍의 목적**은 팀 전체가 <u>도메인 지식을 공유를 통해 프로젝트의 방향성을 얼라인(align)시키는 것</u>에 있습니다.
이 과정에는 프론트엔드 개발자, 백엔드 개발자, 데브옵스 개발자, 인프라 엔지니어 등의 소프트웨어 관련 담당자만 참여하는 것이 아닙니다.

하나의 프로젝트 팀에 속하는 기획자와 프로젝트 매니저, UI/UX 디자이너 등 모든 인원이 참가하게 됩니다.
모든 구성원이 이해할 수 있는 형태와 언어로 프로젝트를 시각화합니다.
완성된 결과물을 가지고 모든 팀 구성원이 하나의 방향성을 가진 상태로 각자의 역할을 수행하게 됩니다.

일반적으로는 모두가 모여있는 공간에서 큰 화이트보드나 벽에 포스트잇을 자유롭게 붙이는 방식으로 실행되는데, 온라인 환경에서는 miro와 같은 툴을 이용해서 비슷한 효과를 기대할 수 있습니다.





