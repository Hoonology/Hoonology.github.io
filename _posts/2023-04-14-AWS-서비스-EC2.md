---
date: 2023-04-14 01:00:00
layout: post
title: AWS 서비스 - EC2
subtitle: AWS 서비스 EC2에 대하여
description: EC2 - 아마존 웹 서비스에서 제공하는 클라우드 컴퓨팅 서비스
image: https://res.cloudinary.com/dvqcvocet/image/upload/v1681432465/dev-jeans_%E1%84%87%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A1%E1%84%87%E1%85%A9%E1%86%AB_y5n0eh.png
optimized_image: https://res.cloudinary.com/dvqcvocet/image/upload/v1681432465/dev-jeans_%E1%84%87%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A1%E1%84%87%E1%85%A9%E1%86%AB_y5n0eh.png 
category: AWS
tags:
  - AWS
  - cloud
  - EC2
  - 인스턴스
  - AMI
author: Hoonology
comments: true



---

# EC2 ( Elastic Compute Cloud )
클라우드 컴퓨팅 서비스 ( ***아마존에서 가상의 컴퓨터를 한 대 빌리는 것*** )

- 인터넷(클라우드)을 통해 서버, 스토리지, 데이터베이스 등의 컴퓨팅 서비스를 제공하는 서비스

- ***Elastic Compute Cloud***  
  - Elastic이 무엇인가 ?( = '탄력적인')   
    - PC방 후불제 처럼 사용한 것만 지불하면 되는 구조
  - 성능, 용량을 자유롭게 조절할 수 있다.

## EC2 장점
### 1. 구성하는 시간 단축
![ec2_1](/assets/img/AWS/ec2pros.png)

### 2. 다양한 OS 선택 가능
AMI를 통해서 필요한 용도에 따라 다양한 운영체제에 대한 선택이 가능  
**At Plus**, CPU와 RAM, 용량까지도 손쉽게 구성할 수 있다.  

![ec2_2](/assets/img/AWS/OSselect.png)



## 인스턴스
가상 컴퓨팅 환경(서버),  
인스턴스에서 실행하려는 애플리케이션 또는 소프트웨어에 필요한 메모리 양과 컴퓨팅 파워를 기준으로 인스턴스 유형을 선택

### 인스턴스 유형
- 인스턴스를 시작할 때 지정하는 인스턴스 유형에 따라 인스턴스에 사용되는 호스트 컴퓨터의 하드웨어가 결정
  - [인스턴스 유형 레퍼런스](https://aws.amazon.com/ko/ec2/instance-types/)



### AMI( Amazon Machine Image)
***소프트웨어 구성이 기재된 템플릿***  
클라우드에서 실행되는 서버에 대한 모든 소프트웨어 환경 설정 정보를 포함한 기본 설계도 또는 청사진
![ami](/assets/img/AWS/AMI.png)
- OS( 윈도우, 우분투 리눅스 등 ), 애플리케이션 서버와 세부 내용 포함
- 특정 런타임이 설치 되어있는 템플릿( 우분투 + node.js, 윈도우 + JVM 등 ) 
- 자신이 원하는 수만큼 인스턴스 생성 가능


## EC2 인스턴스 생성의 의미
***AMI를 토대로 세팅된 PC를 빌린다.***
![ec2](/assets/img/AWS/EC2AmiInstance.png)

## 인스턴스 라이프 사이클
다양한 상태로의 전환은 아래와 같다.
![insatance](/assets/img/AWS/instance.png)

#### [Reference](https://docs.aws.amazon.com/ko_kr/ko_kr/AWSEC2/latest/UserGuide/ec2-instance-lifecycle.html)

| 인스턴스 상태 | 설명 | 인스턴스 사용 요금 |
| --- | --- | --- |
| pending | 인스턴스는 running 상태로 될 준비를 하고 있습니다. 인스턴스를 처음 시작하거나 pending 상태의 인스턴스를 다시 시작하면 stopped 상태가 됩니다. | 미청구 |
| running | 인스턴스를 실행하고 사용할 준비가 되었습니다. | 청구 |
| terminated | 인스턴스가 영구적으로 삭제되었으며 시작할 수 없습니다. | 미청구 |
| shutting-down | 인스턴스가 종료할 준비를 하고 있습니다. | 미청구 |
| stopped | 인스턴스가 종료되고 사용이 불가합니다. 언제든지 인스턴스를 다시 시작할 수 있습니다. | 미청구 |
| stopping | 인스턴스가 중지 또는 중지-최대 절전 모드로 전환할 준비를 하고 있습니다. | 중지 준비 중인 경우 미청구, 최대 절전 모드로 전환 준비 중인 경우 청구 | 


### 인스턴스 시작 
- 인스턴스 시작 시, ```pending``` 상태로 전환 - 사용자가 지정한 인스턴스 유형에 따라 인스턴스에 사용되는 호스트 컴퓨터의 하드웨어 결정
  - AMI를 통해 부팅
- 사용 준비 후, ```running``` 상태로 전환 - running 상태로 전환하는 **즉시** 인스턴스 실행 지속에 따른 비용 청구(매 초, 최소 1분)

### 인스턴스 중지 및 시작 ( Amazon EBS 지원 인스턴스 )
인스턴스가 상태 확인을 통과하지 못하거나 애플리케이션이 예상대로 실행되고 있지 않은 경우 또는 인스턴스의 루트 볼륨이 ```Amazon EBS``` 볼륨인 경우 인스턴스를 중지했다가 시작하여 문제를 해결해 볼 수 있다.

- 인스턴스 중지 시, ```stopping``` 상태로 전환 - ```stopped``` 상태로 전환
  - 모든 Amazon EBS 볼륨에 대한 스토리지 요금은 부과됩니다. 인스턴스가 stopped상태인 경우 인스턴스 유형을 비롯하여 인스턴스의 특정 속성을 수정할 수 있습니다.
  - 인스턴스를 중지했다가 시작하면 이전 호스트 컴퓨터의 인스턴스 스토어 볼륨에 있는 데이터가 모두 손실
  - ```stopped```에서 ```running```으로 인스턴스를 전환할 때마다 **인스턴스 실행 시간에 대해 초 단위로 요금을 청구**하며, 인스턴스를 시작할 때마다 최소 1분의 요금이 부과됩니다.

### 인스턴스 최대 절전 모드( Amazon EBS 지원 인스턴스 )
- ```stopping``` 상태로 전환되고 나서 ```stopped``` 상태로 전환
- 인스턴스 중지와 다르게 최대절전모드 인스턴스가 ```stopped``` 상태면, 해당 인스턴스에 대한 사용 요금 청구 불가
  - ```stopping``` 상태일 때 비용 청구
  - 데이터 전송에 대해 사용 요금이 부과되지는 않지만 RAM 데이터에 대한 스토리지를 포함해 모든 Amazon EBS 볼륨에 대한 스토리지 요금은 부과
- ```pending```상태로 전환, 새 호스트 컴퓨터로 이동

### 인스턴스 재부팅
Amazon EC2를 사용하여 인스턴스에서 운영 체제 재부팅 명령을 실행하는 대신 **인스턴스를 재부팅하는 것이 좋다**.
- 운영 체제 재부팅과 같다.
  - 인스턴스가 동일한 호스트 컴퓨터에 남아 있고, 퍼블릭 DNS 이름, 프라이빗 IP 주소 및 인스턴스 스토어 볼륨의 모든 데이터가 유지됩니다. 
- 인스턴스를 재부팅하면 인스턴스 청구 시간이 새로 시작되지 않으며, 최소 1분 요금 부과 없이 초 단위 결제가 계속

### 인스턴스 만료
AWS에서 인스턴스를 호스팅하는 기본 하드웨어의 복구 불가능한 장애가 검색되는 경우 인스턴스가 만료 대상으로 예약됩니다.   
예약된 만료 날짜에 도달하면 인스턴스가 에 의해 중지되거나 종료됩니다AWS 인스턴스 루트 디바이스가 Amazon EBS 볼륨인 경우 인스턴스가 중지되며  
언제든지 이 인스턴스를 다시 시작할 수 있습니다. 인스턴스 루트 디바이스가 인스턴스 스토어 볼륨인 경우 인스턴스가 종료되어 다시 사용할 수 없습니다.

### 인스턴스 종료
```shutting-down``` 또는 ```terminated```로 변경되는 즉시 해당 인스턴스에 대한 요금 부과가 중지
- 인스턴스는 종료한 후에도 잠시 동안 콘솔에 표시되며 그 이후 항목이 자동으로 삭제
- 종료한 인스턴스에 연결하거나 복구할 수 없습니다.


## 인스턴스 구입 옵션
### On-Demand
장기 약정 없이 초 단위로 컴퓨팅 용량 구입 가능  
온디맨드 인스턴스가 ```running``` 상태인 시간(초)에 대해서만 지불

### Reserved
예약 인스턴스,  
온디맨드 인스턴스 요금과 비교하여 EC2 비용을 절감하는 효과 제공(75% 맥시멈) 
#### 활용하기 좋은 환경 
- 트래픽 안정
- 성능에 대한 요구 수준이 예측 가능

### Spot
스팟 인스턴스는 예비 EC2 용량을 사용하는 인스턴스 ( 온디맨드 보다 저렴하다. )
- 미사용 EC2 인스턴스를 요청할 수 있게 해준다. ( 이로 인해 가격이 저렴해진다. )
- 애플리케이션 실행 시간을 flexible하게 조정
- 애플리케이션을 중단할 수 있는 경우에 선택
#### 사용하기 좋은 환경
- 데이터 분석 
- 배치 작업
- 백그라운드 프로세싱 및 선택적 작업

#### 사용전략
애플리케이션에 대해 보장된 컴퓨팅 리소스를 최소 수준으로 유지하기 위한 한 가지 전략은 온디맨드 인스턴스의 코어 그룹을 시작하고 기회가 생기면 스팟 인스턴스로 이를 보완하는 것입니다.

<br>

## 스토리지  - 인스턴스 루트 볼륨
인스턴스 부팅을 위한 이미지가 포함되어 있다.  
인스턴스 유형에 따라 다른 **EBS 볼륨**이나 **인스턴스 스토어 볼륨**을 사용할 수도 있다.  
- **E**lastic **B**lock **S**tore 혹은 인스턴스 스토어 볼륨 중 하나이다.

> EBS : AWS에서 제공하는 블록 수준의 스토리지 서비스  
 AWS 클라우드에서 Amazon EC2 인스턴스와 함께 사용할 수 있는 지속적인 블록 수준의 스토리지 볼륨을 제공한다.

- 처음 EC2 인스턴스가 론칭되면 모든 루트 디바이스는 **S3**(Simple Storage Service)로부터 론칭에 필요한 정보를 가져온다. 
  - **인스턴스 스토어 기반** : S3를 통해 백업되는 <u>인스턴스 루트 디바이스</u>
- EBS를 제공한 이후 이미지를 EBS 볼륨 기반으로 제공
  - **EBS 기반 인스턴스** : 인스턴스를 론칭할 때마다 루트 디바이스가 EBS 볼륨에서 론칭되고 EBS 스냅샷을 통해 생성

### 인스턴스 스토어 기반 인스턴스
인스턴스는 하나 이상의 인스턴스 스토어 볼륨을 자동으로 사용
- 볼륨 중 하나가 루트 디바이스 볼륨 역할
- 인스턴스가 시작되면 인스턴스를 부팅하는 데 사용된 이미지가 루트 볼륨으로 복사
- 모든 데이터는 <u>인스턴스가 실행되는 동안 유지</u>, <u>종료하거나 장애 발생 시 데이터 삭제</u>
  - 종료 혹은 장애 발생 시 복원 불가능 -> 데이터 분산 필요

### EBS 기반 인스턴스
 EBS 지원 인스턴스를 시작하면 사용하는 AMI가 참조하는 각 EBS 스냅샷에 대한 EBS 볼륨 생성
- 중지한 후 다시 시작해도 연결된 볼륨에 저장된 데이터에 영향이 없다.
- EBS 지원 인스턴스가 중지 상태일 때 다양한 인스턴스 및 볼륨 관련 태스크 수행 가능하다.

## 보안
### 키페어
EC2 는 ```Public Key``` - ```Private Key```방식 사용( 암호화 - 복호화 모델 )
- AWS 콘솔, CLI, API 호출 방식으로 생성한다.
- ```SSH-2 RSA``` 키를 사용하며, 리전당 최대 5,000개의 키 페어를 사용할 수 있다.

### 보안 그룹( Security Group )
가상의 방화벽 - 하나 혹은 다수의 인스턴스에 대한 트래픽 통제
- 인스턴스 론칭 후 해당 인스턴스에 하나 혹은 다수의 보안 그룹 연결
  - 인스턴스로 들어오거나 나가는 트래픽에 대한 처리 규칙 설정 가능( 언제나 수정 가능 )
- 특징
  - ***아웃바운드 트래픽 허용*** ( 인스턴스에서 외부 리소스로 나가는 트래픽을 허용하는 규칙 )
    - 아웃바운드 트래픽을 허용하는 규칙을 구성함으로써 인스턴스에서 인터넷이나 다른 네트워크 리소스와 통신할 수 있도록 허용할 수 있다.
    - 아웃바운드 규칙은 기본적으로 **모든 트래픽을 허용하는 것이 아니며**, 특정 포트와 프로토콜을 사용하고 지정된 대상 IP 주소/범위를 대상으로 하는 것에 대해서만 허용

#### 보안 그룹의 규칙의 특징
- 기본적으로 보안 그룹은 모든 아웃바운드 트래픽 허용
- 거부 여부는 정할 수 없다.
- ```Stateful```속성을 지닌다. ( 상태 보존 )
  - 인스턴스에서 요청을 보내면, 해당 요청에 대한 응답 트래픽은 보안 그룹의 인바운드 규칙과 무관하게 전달이 허용
- 보안 그룹 규칙은 언제든 추가 또는 삭제 가능 - 변경 사항은 시큐리티 그룹에 연결된 모든 인스턴스에 바로 적용

## 네트워킹 - Instance IP 주소 지정
### **Private IPv4**
**인터넷을 통해 연결할 수 없는 IP 주소**   
동일 VPC에서 인스턴스 간의 통신을 위해 사용한다.
> VPC (Virtual Private Cloud) : 논리적으로 격리된 섹션을 프로비저닝"하여 가상 프라이빗 클라우드를 제공하는 상용 클라우드 컴퓨팅 서비스

- 인스턴스를 시작할 때 인스턴스에 기본 프라이빗 IPv4 주소와 내부 DNS 호스트 이름이 할당된다.

### **Public IPv4**
**인터넷을 통해 연결할 수 있는 IPv4 주소**
- 인스턴스가 중지되거나 최대 절전 모드로 전환 혹은 종료되면 인스턴스의 퍼블릭 IP 주소는 해제된다.
  - 새로운 IP 주소가 할당된다.
- 필요에 따라 인스턴스 간에 연결할 수 있는 영구 퍼블릭 IP주소가 필요한 경우 Elastic IP 주소를 대신하여 사용한다.
### **Elastic IP**
**동적 클라우드 컴퓨팅을 위해 고안된 정적 IPv4 주소**  
탄력적 IP주소는 AWS 계정에 할당, 해제 시 까지 할당된 상태로 유지
- 도메인이 인스턴스를 가리키도록 도메인에 대한 DNS 레코드에 탄력적 IP 주소를 지정할 수 있다.
- 탄력적 IP 주소를 사용하면 주소를 계정의 다른 인스턴스에 신속하기 다시 매핑 -> **인스턴스나 소프트웨어의 오류를 마스킹 가능**

# 퀴즈
## 1. EC2 인스턴스를 만들기 위해 설정할 때 용어와 이에 대한 설명으로 틀린 것은?

A.
AMI - 인스턴스에 적용하기 위한 운영체제 및 소프트웨어 환경에 대한 템플릿


B.
인스턴스 유형 - CPU 및 램과 같은 컴퓨팅 성능


C.
EC2 사용자 데이터 - 인스턴스가 시작할 때, 실행되는 스크립트


D.
***EBS - 임시 데이터를 저장하는 스토리지 볼륨으로 인스턴스 중단, 최대 절전 모드로 전환 또는 종료 시 삭제됨***

### 해설 
해당 설명은 인스턴스 스토어 볼륨에 대한 설명이다.  
EBS는 EC2 인스턴스를 위한 영구 스토리지로, EC2의 수명주기(중단, 시작 등의 lifecycle)와 무관하게 데이터의 보관이 가능하다.

## 2. 프라이빗 IP와 퍼블릭 IP에 대한 설명으로 틀린 것은?


A.
퍼블릭 IP는 인터넷 상에서 컴퓨터에 부여된 IP로, 전체 웹을 통틀어서 유일해야 한다.


B.
프라이빗 IP는 사설 네트워크 안에서만 유일성이 보장된다.


C.
프라이빗 IP를 가진 컴퓨터를 인터넷에 연결하려면 NAT과 인터넷 게이트웨이에 연결되어 있어야 한다.


D.
***오직 퍼블릭 IP만이 IPv6 주소 체계를 가질 수 있다.***

### 해설 
IPv6는 퍼블릭 및 프라이빗 IP 모두에서 사용할 수 있는 주소 체계  
IPv4 및 IPv6 주소 체계는 퍼블릭/프라이빗 여부와는 상관없다. IPv6는 기존 IPv4 주소 고갈의 문제를 해결하기 위해 기존 32비트(예: 12.234.56.350)의 주소 길이를 128비트(예: 3ffe:1900:4545:3:200:f8ff:fe21:67cf) 로 확장한 주소 체계이다.

## 3. 김코딩은 EC2를 생성하고, 해당 EC2에 접속하기 위해 SSH 접속을 시도했으나, 접속할 수 없었습니다. 문제를 해결하기 위한 적절한 해결책이 아닌 것은 무엇인가요?


A.
프라이빗 키(pem)와 ssh 클라이언트(ssh 클라이언트 또는 putty 등)를 이용해 접속한다.


B.
아마존 리눅스를 사용하고 있는 경우 'EC2 인스턴스 연결'기능을 이용한다.


C.
보안 그룹에서 22번 포트를 인바운드 규칙에 추가한다.


D.
***AmazonEC2FullAccess 정책이 포함된 IAM 역할을 EC2에 연결한다.***
AmazonEC2FullAccess 정책이 포함된 IAM 역할은, 특정 IAM 사용자로 하여금 EC2에 대한 전체 접근 권한을 주고자 할 때 사용됩니다. EC2 인스턴스 연결과는 무관합니다.

## 4. 보안 그룹에 대한 설명으로 틀린 것은?


A.
기본적으로 모든 인바운드 트래픽을 차단한다.


B.
기본적으로 모든 아웃바운드 트래픽을 허용한다.


C.
***보안 그룹 규칙은 액세스를 거부하는 규칙을 생성할 수 있다.***



D.
보안 그룹의 소스 및 대상(destination)은 CIDR 블록의 형태로 설정할 수 있다  

### 해설
보안 그룹 규칙은, 액세스를 허용하는 규칙을 작성할 수 있을 뿐, 거부하는 규칙을 생성할 수 없습니다.  
아웃바운드의 트래픽을 제어하고 싶다면, 기본 보안 그룹 default를 사용하지 말고, 원하는 아웃바운드 규칙이 적용된 새로운 보안 그룹을 만들면 됩니다.

## 5. EC2 인스턴스를 시작하면, 이후 퍼블릭 IPv4 주소가 할당됩니다. 이후 인스턴스를 중지 및 재시작한 후 해당 EC2 인스턴스에 접속하는 방법으로 적절한 것을 모두 고르면?


A.
퍼블릭 IPv4 주소는 바뀌지 않으므로, 이전 주소 그대로 접속한다.


B.
***새로 할당된 퍼블릭 IPv4 주소로 접속한다.***


C.
***이미 탄력적 IP 주소를 연결했다면, 이를 통해 해당 EC2로 접속한다.***


D.
프라이빗 IPv4 주소로 접속한다.

### 해설 
EC2 인스턴스를 중지하고, 다시 시작하면 퍼블릭 IPv4 주소는 변경된다.  
그러나 탄력적(Elastic) IP를 EC2 인스턴스와 연결하면, EC2 인스턴스의 IP 주소가 변경될 때마다 EIP는 해당 EC2 인스턴스를 가리키게 되어, 늘 같은 EIP로 애플리케이션에 연결할 수 있다.

프라이빗 IP 주소는 인터넷에 직접적으로 연결된 IP 주소가 아니다.


## 6. 보안 그룹과 EC2 인스턴스에 대한 설명으로 틀린 것은?


A.
보안 그룹은 EC2 인스턴스의 인바운드/아웃바운드 트래픽을 제어한다.


B.
**보안 그룹은 오직 하나의 EC2 인스턴스에만 적용할 수 있다.**


C.
하나의 EC2 인스턴스에 여러 개의 보안 그룹을 연결할 수 있다.


D.
EC2 인스턴스를 ssh를 이용해 접속하려고 할 때, Connection timed out 에러는 보안 그룹에서 ssh 포트에 대한 액세스를 차단했기 때문에 발생한다.


### 해설
보안 그룹은 같은 리전, VPC에 속해있는 여러 개의 EC2 인스턴스에 적용할 수 있다.  
Connection timed out 에러 외에, 'connection refused' 에러가 발생하는 경우, 일반적으로 ssh 데몬이 인스턴스 상에서 실행되지 않았거나, 접속을 거부할 때 발생하는 에러이다.

## 7. 인메모리 데이터베이스나, NoSQL 데이터베이스와 같은 애플리케이션에 적합한 인스턴스 타입으로 적합한 것은?


A.
컴퓨트 최적화 인스턴스


B.
**메모리 최적화 인스턴스**


C.
스토리지 최적화 인스턴스


D.
범용 인스턴스

### 해설
인메모리 데이터베이스나 NoSQL 데이터베이스는 메모리에서 막대한 양의 데이터를 처리하므로, 고성능 메모리가 요구된다.