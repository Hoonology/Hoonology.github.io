---
date: 2023-04-16 15:00:00
layout: post
title: AWS 서비스 - VPC
subtitle: AWS 서비스 VPC에 대하여
description: Virtual Private Cloud 서비스 - CIDR, 서브넷, 라우팅 테이블, 네트워크 보안에 대해 알아본다.
image: https://res.cloudinary.com/dvqcvocet/image/upload/v1681432465/dev-jeans_%E1%84%87%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A1%E1%84%87%E1%85%A9%E1%86%AB_y5n0eh.png
optimized_image: https://res.cloudinary.com/dvqcvocet/image/upload/v1681432465/dev-jeans_%E1%84%87%E1%85%A9%E1%86%A8%E1%84%89%E1%85%A1%E1%84%87%E1%85%A9%E1%86%AB_y5n0eh.png 
category: AWS
tags:
  - AWS
  - cloud
  - EC2
  - 인스턴스
  - S3
  - VPC
  - CIDR
  - 서브넷
  - 라우팅 테이블
  
author: Hoonology
comments: true

---

# VPC
Reference : [가상 데이터 센터 만들기 - VPC 기본 및 연결 옵션 ](https://www.youtube.com/watch?v=R1UWYQYTPKo&t=2s)  

Virtual Private Cloud 서비스
> 클라우드 내 프라이빗 공간 제공 -> **퍼블릭과 프라이빗** 영역으로 논리적으로 **분리**
> 네트워크에 대한 완전한 통제권을 가질 수 있다.
  ![vpc](/assets/img/aws/vpc.png)
  ![vpc2](/assets/img/aws/vpc2.png)

VPC가 생기기 전에는 클라우드에 있는 리소스를 격리할 수 있는 방법이 없었으므로 시스템의 복잡성과 인터넷에 대한 의존도가 높았다.  
> 이는 유지 및 관리에 많은 비용과 노력이 투입되었다. 

# VPC 구성요소와 주요 용어
## IP Address
- IPv4 ( 4개의 Octet 으로 이루어짐 )
  - ```172.16.0.0```의 모습 ( .을 기준으로 **각 8 비트씩 총 32 비트**로 구분 되어있다.)
- IPv6 : IPv4의 주소 고갈 문제를 해결하기 위해 개발
  - ```2001:0db8:85a3:0000:0000:8a2e:0370:7334과 같은 형태```의 모습 (**128 비트**로 구성, 8개의 숫자와 16진수로 이루어진 '콜론'으로 구분되는 형식 )

## IP Address Class 
**8 비트의 네트워크 영역**과 해당 네트워크 내에서 **호스트의 주소를 가리키는 나머지 영역**을 구분하기 위해 5가지의 클래스를 사용했다.  
(보통 D,E 클래스는 연구 개발을 위한 예약 IP라 사용하지 않음)

- A 클래스  

  | Network Address | Host Address | Host Address | Host Address |
  |:---------------|:------------:|:------------:|:------------:|
  | 0-127          | 0-255        | 0-255        | 0-255        |

- B 클래스  

  | Network Address | Host Address | Host Address | Host Address |
  |:---------------|:------------:|:------------:|:------------:|
  | 128-191          | 0-255        | 0-255        | 0-255        |

- C 클래스  

  | Network Address | Host Address | Host Address | Host Address |
  |:---------------|:------------:|:------------:|:------------:|
  | 192-223          | 0-255        | 0-255        | 0-255        |


## CIDR
Classless inter-domain routing  
클래스가 없는 도메인 간 라우팅 기법 ( **IP 클래스 방식을 대체한 방식** )
- ```172.16.0.0/16```
  - ```/16``` : 첫 16 비트를 Network Address로 사용한다는 의미, 2^16(65,536)개의 IP 주소를 사용할 수 있는 커다란 네트워크 블록
- Network Address 와 Host Address를 사용하지 않아도, 원하는 블록만큼 Network Address를 지정하여 운용할 수 있다.

  | CIDR 블록 | IP 주소의 수 |
  |:------------|:----------------------:|
  | /28         |           16           |
  | /24         |          254           |
  | /20         |         4094           |
  | /18         |        16,382          |
  | /16         |        65,536          |


## 서브넷
Subnet( Subnetwork )  
IP 네트워크의 논리적인 하위 부분 - 서브넷을 통해 하나의 네트워크를 여러 개로 나눌 수 있다.( 모든 서브넷은 라우팅을 지닌다. )  
- 퍼블릭 서브넷 : 인터넷을 통해 연결할 수 있는 서브넷
- 프라이빗 서브넷 : 인터넷을 연결하지 않고 보안을 유지하는 배타적인 서브넷
- VPN Only 서브넷 : 기업 데이터 센터와 VPC를 연결하는 서브넷

서브넷은 VPC의 CIDR 블록을 이용해 정의되며, 최소 크기의 서브넷은 ```/28```이다.  
AWS가 확보한 서브넷 중 처음 네 개의 IP주소와 마지막 IP주소는 인터넷 네트워킹을 위해 예약되어 있다. ( 서브넷에서 가용 IP 주소를 계산할 때는 항상 이 부분을 기억 )

## 라우팅 테이블
Routing Table  
- 하나의 지점에서 또 다른 지점으로 가기 위한 모든 정보를 제공하기 위한 테이블
- 트래픽의 전송 방향을 결정하는 라우트와 관련된 규칙을 담은 테이블로 목적지를 향한 최적의 경로로 **데이터 패킷을 전송하기 위한 모든 정보를 담고 있다**.
![vpc3](/assets/img/AWS/vpc3.png)
[사진] 'local' : 내부에서만 계속 패킷을 보낼 수 있는 라우팅 테이블

![vpc4](/assets/img/aws/vpc4.png)
[사진] ```0.0.0.0/0``` : VPC로 향하지 않는 모든것은 인터넷으로 보내기  

## VPC의 네트워크 보안
Network ACLs : Stateless firewalls  
> 서브넷 단위로 적용 가능

![Security](/assets/img/AWS/security%20groups.png)
IP 주소를 지정하지 않고, Security 그룹을 자동으로 붙여주게 되면 해당 Security 그룹이 붙여져 있는 서버로 부터 오는 모든 트래픽을 명시할 수 있다.
> 굉장히 단단하게 방화벽을 설정할 수 있다.
> 원하는 곳에서 원하는 포트로 들어오는 트래픽만 허용할 수 있는 설정을 할 수 있다.

## 위 과정 정리 
#### 1. IP 어드레스 선택 
#### 2. 서브넷을 나눈다.
#### 3. 인터넷으로 연결되는 경로 ( 라우팅 )를 통해 길을 만들어준다.
#### 4. 보안 그룹 ( Network ACL )을 통해 방화벽 정책을 갖고 접속을 허용하는 조건 설정


# Quiz
### 1. CIDR 블록에서 AWS 내부용으로 예약돼 사용자가 접근할 수 없는 IP주소는 몇 개인가?  

AWS는 다음과 같은 IPv4 주소 범위를 내부 용도로 예약하고 있습니다.

- 10.0.0.0/8
- 100.64.0.0/10
- 172.16.0.0/12
- 192.168.0.0/16

AWS 내부적인 목적으로 처음 4개와 마지막 1개, 총 5개의 IP 주소를 예약합니다.



### 2. VPC에서 실행 중인 인스턴스에 접근하는 특정 트래픽을 명시적으로 거부하려면 어떻게 해야합니까?

A.
보안 그룹을 사용


B.
라우트 테이블에 엔트리 추가


C.
프라이빗 서브넷에 해당 인스턴스를 넣음


D.
***네트워크 액세스 제어 목록(NACL) 활용***

[해설]  
보안 그룹을 이용하면 특정 트래픽을 허용 혹은 불허 할 수 있지만, 보안 그룹에는 거부 옵션이 없으므로 명시적으로 거부할 수는 없습니다. 라우트 테이블에도 거부 옵션이 없습니다. 프라이빗 서브넷에 인스턴스를 넣으면 해당 인스턴스와 인터넷 연결만 제거한 것일 뿐, 특정 트래픽을 거부하지는 못합니다.


<br>

### 3. 김코딩은 퍼블릭 서브넷에 웹 서버를 생성했고, 누구든 인터넷을 통해 해당 웹서버에 접근할 수 있습니다. 이런 내용을 변경해서 웹 서버에 접근하는 트래픽은 반드시 로드 밸런서를 통하도록 하려면 어떻게 해야 합니까?

A.
인터넷 게이트웨이 제거


B.
라우트 테이블에 로드밸런서 추가


C.
퍼블릭 서브넷의 NACL에 로드 밸런서 접근 허용


D.
**해당 인스턴스의 시큐리티 그룹 내용을 변경해 로드 밸런서가 웹서버와 소통할 수 있게함**

[해설]  
인터넷 게이트웨이를 제거하면, 로드 밸런서를 통한 웹 연결이 더 이상 해당 인스턴스에 미치지 못하게 되며, 라우트 테이블에서 로드 밸런서를 위한 라우트 규칙을 추가해야 합니다. NACL은 특정 트래픽을 허용 또는 차단하지만, 이번 경우에는 NACL을 사용할 수 없습니다.

<br>




### 4. 다음 중 VPC 내의 로컬 라우트 테이블이 허용하는 것은 무엇입니까?
A.
***VPC 내 서로 다른 서브넷에서 실행 중인 모든 인스턴스가 서로 소통할 수 있도록 합니다.***


B.
인터넷으로 라우팅 되는 트래픽만 허용함


C.
다수의 VPC가 서로 소통할 수 있도록 함


D.
인스턴스가 로컬 라우트를 이용해 인터넷과 소통하도록 함

[해설]  
인터넷으로 향하는 트래픽은 인터넷 게이트웨이를 거쳐 지나갑니다. 다수의 VPC는 VPC 피어링을 통해 서로 소통할 수 있습니다.

